# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

---

**üöÄ –ù–ê–ß–ê–õ–û –ù–û–í–û–ô –°–ï–°–°–ò–ò:**
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏ Claude Code **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –ø—Ä–æ—á–∏—Ç–∞–π —Ñ–∞–π–ª [TASKS.md](TASKS.md) –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –∑–∞–¥–∞—á–∞–º–∏ –æ—Ç—Ç—É–¥–∞. –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ TODO –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–µ—Å—Å–∏–π.

---

**üìã –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï:** –î–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ Linux-—Å–µ—Ä–≤–µ—Ä–µ —Å–º–æ—Ç—Ä–∏ [DEPLOY.md](DEPLOY.md) - —Ç–∞–º –ø–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ Swift, TDLib, –Ω–∞—Å—Ç—Ä–æ–π–∫–µ systemd –∏ –æ—Ç–ª–∞–¥–∫–µ.

---

## –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π Telegram-–∫–ª–∏–µ–Ω—Ç –±–µ–∑ UI –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏ —á–∞—Ç–∞–º–∏.

**–û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞–±–æ—Ç—ã:**
1. –ö–ª–∏–µ–Ω—Ç –ª–æ–≥–∏–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ –º–æ–π –∞–∫–∫–∞—É–Ω—Ç
2. –ü–æ–ª—É—á–∞–µ—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —á–∞—Ç–æ–≤
3. –°–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–∞–º–º–∞—Ä–∏ —á–µ—Ä–µ–∑ AI-–∞–≥–µ–Ω—Ç–∞ (OpenAI/Anthropic)
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–Ω–µ —á–µ—Ä–µ–∑ —á–∞—Ç-–±–æ—Ç–∞

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:**
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–¥—ë—Ç—Å—è –Ω–∞ macOS, –Ω–æ —Ä–µ–ª–∏–∑–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ Linux-—Å–µ—Ä–≤–µ—Ä–µ ‚Äî –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–¥—É–º–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –æ—à–∏–±–æ–∫ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
- –°–ª–µ–¥–æ–≤–∞—Ç—å TDD-–ø–æ–¥—Ö–æ–¥—É: —Å–Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç—ã, –∑–∞—Ç–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –í—Å–µ –Ω–æ–≤—ã–µ –≤–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ (—Ä–∞–±–æ—Ç–∞—Ç—å —Å Swift 6.0), —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –Ω–µ —Å—Ç–∞—Ä—à–µ –ø–æ–ª—É–≥–æ–¥–∞

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ –º–æ–¥—É–ª–∏

1. **ChatFetcher** (–ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç TDLibAdapter –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Telegram API
   - –§–∏–ª—å—Ç—Ä—É–µ—Ç —á–∞—Ç—ã –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—é ¬´–µ—Å—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è¬ª
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏

2. **SummaryGenerator** (—Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–∞–º–º–∞—Ä–∏)
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å –≤–Ω–µ—à–Ω–∏–º AI API (–Ω–∞–ø—Ä–∏–º–µ—Ä, OpenAI/Anthropic)
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ API –∏ —Ç–∞–π–º–∞—É—Ç—ã

3. **BotNotifier** (–æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ –±–æ—Ç–∞)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Telegram Bot API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
   - –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–∞–º–º–∞—Ä–∏ –≤ —É–¥–æ–±–æ—á–∏—Ç–∞–µ–º—ã–π –≤–∏–¥ (Markdown)
   - –õ–æ–≥–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–∫–∏

4. **Logger** (—Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
   - –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —É—Ä–æ–≤–Ω–µ–π: debug, info, warning, error
   - –í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞) –∏ —Ñ–∞–π–ª (–ø—Ä–æ–¥–∞–∫—à–Ω)
   - –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ –Ω–∞ Linux-—Å–µ—Ä–≤–µ—Ä–µ

### –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

- **–¢–µ—Å—Ç—ã –ø–µ—Ä–≤—ã–º–∏**: –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—ë–º `Tests/<Module>Tests/<Module>Tests.swift` —Å –±–∞–∑–æ–≤—ã–º–∏ –∫–µ–π—Å–∞–º–∏, –∑–∞—Ç–µ–º –ø–∏—à–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é.
- **–†–∞–±–æ—Ç–∞ —Å –≤–µ—Ç–∫–∞–º–∏**: –î–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ —Å–æ–∑–¥–∞—ë–º –æ—Ç–¥–µ–ª—å–Ω—É—é feature-–≤–µ—Ç–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `feature/chat-fetcher` –∏–ª–∏ `fix/xcode-build`). –†–∞–±–æ—Ç–∞–µ–º –≤ –Ω–µ–π –¥–æ –ø–æ–ª–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤. –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–µ—Ä–∂–∏–º –≤ `main`. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ—Ä–∂–∞—Ç—å `main` –≤—Å–µ–≥–¥–∞ –≤ —Ä–∞–±–æ—á–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∏ –æ–±–ª–µ–≥—á–∞–µ—Ç code review.
  ```bash
  # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≤–µ—Ç–∫–∏ –¥–ª—è –∑–∞–¥–∞—á–∏
  git checkout -b feature/task-name

  # –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
  git push -u origin feature/task-name
  # –°–æ–∑–¥–∞—ë–º Pull Request —á–µ—Ä–µ–∑ GitHub CLI –∏–ª–∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  ```
- **–ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**: –ò—Å–ø–æ–ª—å–∑—É–µ–º `#if os(macOS)` / `#if os(Linux)` —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ –Ω–µ–∏–∑–±–µ–∂–Ω–æ. –†–µ–≥—É–ª—è—Ä–Ω–æ —Å–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç –Ω–∞ Linux —á–µ—Ä–µ–∑ Docker:
  ```bash
  docker run --rm -v $(pwd):/code swift:6.0 bash -c "cd /code && swift build"
  ```
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ**: –ü–µ—Ä–µ–¥ –ª—é–±–æ–π –æ–ø–µ—Ä–∞—Ü–∏–µ–π —Å –≤–Ω–µ—à–Ω–∏–º API (Telegram, AI, Bot) ‚Äî –ª–æ–≥ —Ç–∏–ø–∞ `logger.info("Fetching unread chats...")`. –ü–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Äî `logger.info("Fetched \(count) chats")` –∏–ª–∏ `logger.error("Failed to fetch: \(error)")`.
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –í—Å–µ —Å–µ—Ç–µ–≤—ã–µ –≤—ã–∑–æ–≤—ã –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ `do-catch`, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–µ enum-–æ—à–∏–±–∫–∏ (`enum ChatFetcherError: Error`).

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

–ü—Ä–æ–µ–∫—Ç —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ TDLib –∏ pkg-config –≤ —Å–∏—Å—Ç–µ–º–µ:
- macOS:
  ```bash
  brew install tdlib pkg-config
  ```
- Linux:
  ```bash
  apt install libtdjson-dev pkg-config
  ```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
export TELEGRAM_API_ID=<your_api_id>
export TELEGRAM_API_HASH=<your_api_hash>
export TDLIB_STATE_DIR=~/.tdlib  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ~/.tdlib

# –í–ê–ñ–ù–û –¥–ª—è macOS: —É–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Ç—å –∫ pkg-config —Ñ–∞–π–ª–∞–º TDLib
export PKG_CONFIG_PATH="/opt/homebrew/opt/tdlib/lib/pkgconfig:$PKG_CONFIG_PATH"
```

API credentials –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –Ω–∞ https://my.telegram.org/apps

**–î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** –¥–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `~/.zshrc` –∏–ª–∏ `~/.bash_profile`:
```bash
echo 'export PKG_CONFIG_PATH="/opt/homebrew/opt/tdlib/lib/pkgconfig:$PKG_CONFIG_PATH"' >> ~/.zshrc
```

## SSH –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω-—Å–µ—Ä–≤–µ—Ä—É

–ü—Ä–æ–¥–∞–∫—à–µ–Ω-—Å–µ—Ä–≤–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ `~/.ssh/config` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–ª–∏–∞—Å –∏–∑ SSH config)
ssh ufohosting

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
ssh root@45.8.145.191
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH-–∫–ª—é—á–∞ (—É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ):**
- SSH-–∫–ª—é—á: `~/.ssh/ufohosting`
- –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–ª—é—á–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ —á–µ—Ä–µ–∑ `UseKeychain yes` –≤ `~/.ssh/config`
- –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ macOS –∫–ª—é—á –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏
ssh-add -l

# –ï—Å–ª–∏ –∫–ª—é—á –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –¥–æ–±–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å)
ssh-add --apple-use-keychain ~/.ssh/ufohosting
```

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

**üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ö–æ–º–∞–Ω–¥—ã –Ω–∏–∂–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ macOS. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ Linux —Å–º. [DEPLOY.md](DEPLOY.md)

### –°–±–æ—Ä–∫–∞
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PKG_CONFIG_PATH —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (—Å–º. "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è")
swift build

# –ü—Ä–æ–¥–∞–∫—à–µ–Ω-—Å–±–æ—Ä–∫–∞ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
swift build -c release
```

### –ó–∞–ø—É—Å–∫
```bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (—Å –ª–æ–≥–∞–º–∏)
swift run tg-client

# –ü—Ä–æ–¥–∞–∫—à–µ–Ω (–±–µ–∑ –ª–æ–≥–æ–≤ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
swift run tg-client 2>/dev/null

# –° —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ª–æ–≥–æ–≤ –≤ —Ñ–∞–π–ª
swift run tg-client 2>app.log
```

### –¢–µ—Å—Ç—ã
```bash
swift test
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
```bash
swift test --filter TelegramCoreTests
```

### –°–±–æ—Ä–∫–∞ –≤ Docker (–ø—Ä–æ–≤–µ—Ä–∫–∞ Linux-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
```bash
docker run --rm -v $(pwd):/code swift:6.0 bash -c "cd /code && swift build"
```

## –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞: 'td/telegram/td_json_client.h' file not found

**–ü—Ä–∏—á–∏–Ω–∞**: Swift Package Manager –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã TDLib.

**–†–µ—à–µ–Ω–∏–µ**:
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ TDLib —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: `brew list tdlib` (macOS)
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pkg-config: `brew install pkg-config` (macOS)
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```bash
   export PKG_CONFIG_PATH="/opt/homebrew/opt/tdlib/lib/pkgconfig:$PKG_CONFIG_PATH"
   ```

### –û—à–∏–±–∫–∞: argument 'dependencies' must precede argument 'path'

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ Package.swift –¥–ª—è `.testTarget()`.

**–†–µ—à–µ–Ω–∏–µ**: –í Package.swift –ø–∞—Ä–∞–º–µ—Ç—Ä `dependencies` –¥–æ–ª–∂–µ–Ω –∏–¥—Ç–∏ –ø–µ—Ä–µ–¥ `path`:
```swift
.testTarget(
    name: "TelegramCoreTests",
    dependencies: ["TelegramCore"],  // dependencies –ø–µ—Ä–≤—ã–º
    path: "Tests/TelegramCoreTests"
)
```

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ Sendable –≤ Swift 6

**–ü—Ä–∏—á–∏–Ω–∞**: Swift 6 –≤–∫–ª—é—á–∞–µ—Ç —Å—Ç—Ä–æ–≥—É—é –ø—Ä–æ–≤–µ—Ä–∫—É concurrency.

**–†–µ—à–µ–Ω–∏–µ**:
- –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å `Sendable` –ø—Ä–æ—Ç–æ–∫–æ–ª—É
- Closures, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ `@Sendable`
- –ö–ª–∞—Å—Å—ã —Å mutable state –∏—Å–ø–æ–ª—å–∑—É—é—Ç `@unchecked Sendable` —Å —Ä—É—á–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π

### –ü—Ä–æ–±–ª–µ–º—ã –Ω–∞ Linux-—Å–µ—Ä–≤–µ—Ä–µ

**–°–º. [DEPLOY.md](DEPLOY.md)** –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–ª—è Linux:
- –†–∞–∑–ª–∏—á–∏—è –≤ —É—Å—Ç–∞–Ω–æ–≤–∫–µ TDLib (apt vs brew)
- –†–∞–∑–ª–∏—á–∏—è –≤ pkg-config –ø—É—Ç—è—Ö
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –¢—Ä—ë—Ö—Å–ª–æ–π–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

1. **CTDLib (System Library)**: Swift-–±–∏–Ω–¥–∏–Ω–≥–∏ –∫ –Ω–∞—Ç–∏–≤–Ω–æ–º—É C API TDLib —á–µ—Ä–µ–∑ module map
   - `Sources/CTDLib/shim.h`: –í–∫–ª—é—á–∞–µ—Ç `td_json_client.h`
   - `Sources/CTDLib/module.modulemap`: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–¥—É–ª—å –∏ –ª–∏–Ω–∫—É–µ—Ç `libtdjson`

2. **TDLibAdapter (Middle Layer)**: Swift-–æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ CTDLib, –∫–æ—Ç–æ—Ä–∞—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:
   - –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª TDLib –∫–ª–∏–µ–Ω—Ç–∞ (create/destroy)
   - JSON-–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é —Å TDLib (–º–µ—Ç–æ–¥—ã `send`/`receive`)
   - State machine –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –∫–æ–¥–∞, 2FA –ø–∞—Ä–æ–ª—è)
   - –§–æ–Ω–æ–≤—ã–π receive loop –Ω–∞ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π dispatch queue
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

   –ö–ª—é—á–µ–≤–æ–π —Ç–∏–ø: `TDLibClient` - –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å TDLib

3. **App (Executable)**: CLI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ:
   - –ß–∏—Ç–∞–µ—Ç credentials –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Å–æ–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –±–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–ª–æ–≥–∏–Ω –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ `getMe`)

### –ü–∞—Ç—Ç–µ—Ä–Ω –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ —Å TDLib

- –í—Å—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JSON-—Å–ª–æ–≤–∞—Ä–∏ —Å –ø–æ–ª–µ–º `@type`
- `send()` - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ TDLib
- `receive(timeout:)` - –±–ª–æ–∫–∏—Ä—É—é—â–∏–π –≤—ã–∑–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π/–æ—Ç–≤–µ—Ç–æ–≤
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω state machine —á–µ—Ä–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `updateAuthorizationState`

### –ü–æ—Ç–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–ê–¥–∞–ø—Ç–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è:
1. `authorizationStateWaitTdlibParameters` ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. `authorizationStateWaitPhoneNumber` ‚Üí –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω
3. `authorizationStateWaitCode` ‚Üí –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç SMS/app –∫–æ–¥
4. `authorizationStateWaitPassword` ‚Üí –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç 2FA –ø–∞—Ä–æ–ª—å (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
5. `authorizationStateReady` ‚Üí —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ callback

### –ú–æ–¥—É–ª—å TelegramCore

–°–µ–π—á–∞—Å —ç—Ç–æ placeholder-–º–æ–¥—É–ª—å (`Sources/TelegramCore/TelegramCore.swift`), –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ Telegram. –ò–º–µ–µ—Ç –±–∞–∑–æ–≤—ã–π test suite –≤ `Tests/TelegramCoreTests/`.

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∫–æ–¥–∞

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å TDLib:
- –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—è `@type` –≤ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö JSON-–æ–±—ä–µ–∫—Ç–∞—Ö
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ dispatch queues –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ - receive loop —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ñ–æ–Ω–æ–≤–æ–π queue
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è: `$TDLIB_STATE_DIR/{db,files}` –ø–ª—é—Å `tdlib.log`
- –ö–ª–∏–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è –ø—Ä–∏ deinit, –æ—Å–≤–æ–±–æ–∂–¥–∞—è —Ä–µ—Å—É—Ä—Å—ã TDLib

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–°–º. `Package.swift`. –û—Å–Ω–æ–≤–Ω—ã–µ:
- TDLib (—Å–∏—Å—Ç–µ–º–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —á–µ—Ä–µ–∑ Homebrew/apt)
- swift-log 1.6.4+ (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ Swift 6.0
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è (–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –º–µ—Å—è—Ü–µ–≤)
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É (macOS + Linux)

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫

- **TDLib**: https://core.telegram.org/tdlib/docs
  - –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã: `getChats`, `getChatHistory`, `sendMessage` (—á–µ—Ä–µ–∑ –±–æ—Ç–∞)
- **swift-log**: https://github.com/apple/swift-log

## –°—Ç–∏–ª—å –∫–æ–¥–∞

- –û—Ç—Å—Ç—É–ø—ã: 4 –ø—Ä–æ–±–µ–ª–∞
- Naming: camelCase –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, PascalCase –¥–ª—è —Ç–∏–ø–æ–≤
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å: Swift Concurrency (async/await) –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –≤—ã–∑–æ–≤–æ–≤
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏, –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–µ enum —Å associated values –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

## Git –∫–æ–º–º–∏—Ç—ã

- –°–æ–æ–±—â–µ–Ω–∏—è –∫–æ–º–º–∏—Ç–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- **–ù–ï –¥–æ–±–∞–≤–ª—è—Ç—å** "Generated with Claude Code" –∏–ª–∏ "Co-Authored-By: Claude"
- –§–æ—Ä–º–∞—Ç: –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ, –∑–∞—Ç–µ–º —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π —á–µ—Ä–µ–∑ –¥–µ—Ñ–∏—Å
- –ö–æ–º–º–∏—Ç–∏—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–º–µ—Å—Ç–µ
- **–í–ê–ñ–ù–û: –†–∞–∑–¥–µ–ª—è–π –∫–æ–º–º–∏—Ç—ã:**
  - –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ (Sources/, Tests/) - –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–º–∏—Ç
  - –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (CLAUDE.md, DEPLOY.md, TASKS.md) - –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–º–∏—Ç
  - –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç code review –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
