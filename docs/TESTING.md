# –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

> üìã **–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2025-10-28

## ‚ö†Ô∏è –ù–µ—Å–Ω–∏–º–∞–µ–º–æ–µ –ø—Ä–∞–≤–∏–ª–æ

**–í—Å–µ —Ç–µ—Å—Ç—ã –ø–∏—à—É—Ç—Å—è –¢–û–õ–¨–ö–û –Ω–∞ Swift Testing —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–µ (–ù–ï XCTest).**

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://developer.apple.com/documentation/testing

---

## –£—Ä–æ–≤–Ω–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### Unit-—Ç–µ—Å—Ç—ã
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π/–∫–ª–∞—Å—Å–æ–≤
- –ú–æ–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ë—ã—Å—Ç—Ä—ã–µ, –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
- –ü—Ä–∏–º–µ—Ä—ã: TDLibRequestEncoder, TDLibUpdate, –º–æ–¥–µ–ª–∏

### Component-—Ç–µ—Å—Ç—ã
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- –ë–µ–∑ –≤–Ω–µ—à–Ω–µ–π —Å–µ—Ç–∏
- –ú–æ–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è C API –∏ —Å–µ—Ç–µ–≤—ã—Ö –≤—ã–∑–æ–≤–æ–≤
- –ü—Ä–∏–º–µ—Ä—ã: TDLibClient (—Å –º–æ–∫ TDLib), –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### E2E-—Ç–µ—Å—Ç—ã
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º TDLib
- –¢—Ä–µ–±—É—é—Ç credentials
- –ú–µ–¥–ª–µ–Ω–Ω—ã–µ, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤ CI
- –ü—Ä–∏–º–µ—Ä—ã: –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## TDD Workflow

RED ‚Üí GREEN ‚Üí REFACTOR

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç—ã

**–ü—Ä–∏–Ω—Ü–∏–ø:** –¢–µ—Å—Ç—ã ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –æ —Ç–æ–º, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–Ω–µ—à–Ω–∏–µ API.

#### –ì–¥–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —á—Ç–æ

**‚úÖ –í —Ç–µ—Å—Ç–∞—Ö:**
- –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤–Ω–µ—à–Ω–∏—Ö API (TDLib, OpenAI, Telegram Bot API)
- –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω—ã—Ö JSON –æ—Ç–≤–µ—Ç–æ–≤
- –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º
- Edge cases –≤–Ω–µ—à–Ω–∏—Ö API

**‚úÖ –í –∫–æ–¥–µ:**
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π (–ø—Ä–æ—Ç–æ–∫–æ–ª—ã, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)
- –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –Ω–∞—à–∏—Ö –º–æ–¥—É–ª–µ–π (—á—Ç–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç)
- –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–ø–æ—á–µ–º—É –ø—Ä–∏–Ω—è—Ç–æ —Ç–∞–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ)

#### –ü—Ä–∏–º–µ—Ä

```swift
// Tests/TDLibAdapterTests/TDLibCodableModels/Responses/ChatTests.swift

/// –¢–µ—Å—Ç—ã –¥–ª—è –º–æ–¥–µ–ª–∏ Chat
///
/// **TDLib API:** https://core.telegram.org/tdlib/docs/classtd_1_1td__api_1_1chat.html
///
/// TDLib –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ—Å—Ç—å –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞:
/// - `unread_count` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
/// - `last_read_inbox_message_id` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–∑–æ–≤–µ viewMessages
/// - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON –≤ snake_case —Ñ–æ—Ä–º–∞—Ç–µ
@Suite("Chat model decoding")
struct ChatTests {
    @Test("Decode channel with unread messages")
    func decodeChannelWithUnread() throws {
        // –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ TDLib
        let json = """
        {
            "id": 123456789,
            "type": { "@type": "chatTypeChannel" },
            "title": "Tech News",
            "unread_count": 5,
            "last_read_inbox_message_id": 100
        }
        """

        let chat = try JSONDecoder().decode(Chat.self, from: json)

        #expect(chat.unreadCount == 5)  // snake_case ‚Üí camelCase
        #expect(chat.lastReadInboxMessageId == 100)
    }
}

// Sources/TDLibAdapter/TDLibCodableModels/Responses/Chat.swift

/// –ú–æ–¥–µ–ª—å —á–∞—Ç–∞ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
///
/// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `ChannelMessageSource` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–æ–≤
/// –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
struct Chat: Codable, Sendable, Equatable {
    let id: Int64
    let unreadCount: Int
    let lastReadInboxMessageId: Int64

    enum CodingKeys: String, CodingKey {
        case id
        case unreadCount = "unread_count"
        case lastReadInboxMessageId = "last_read_inbox_message_id"
    }
}
```

#### –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ

1. **–¢–µ—Å—Ç—ã —á–∏—Ç–∞—é—Ç—Å—è —á–∞—â–µ** ‚Äî –∫–æ–≥–¥–∞ —Ä–∞–∑–±–∏—Ä–∞–µ—à—å—Å—è –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–π API
2. **–¢–µ—Å—Ç—ã = executable documentation** ‚Äî –ø—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω—ã—Ö JSON —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
3. **–ö–æ–¥ –æ—Å—Ç–∞—ë—Ç—Å—è —á–∏—Å—Ç—ã–º** ‚Äî —Ñ–æ–∫—É—Å –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ª–æ–≥–∏–∫–µ
4. **–õ–µ–≥—á–µ –º–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é** ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö, –∫–æ–¥ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å

#### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ

| –ú–æ–¥—É–ª—å | –í–Ω–µ—à–Ω–∏–π API | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ –∫–æ–¥–µ |
|--------|-------------|----------------------|---------------------|
| TDLibAdapter | TDLib C API | –ü—Ä–∏–º–µ—Ä—ã JSON –æ—Ç–≤–µ—Ç–æ–≤ | `TDLibClientProtocol` |
| OpenAISummaryGenerator | OpenAI API | HTTP responses | `SummaryGeneratorProtocol` |
| TelegramBotNotifier | Telegram Bot API | API examples | `BotNotifierProtocol` |

## Coverage Requirements

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π coverage –¥–ª—è PR: **TODO**

## –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

- Swift Testing framework (Swift 6)
- CI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- Coverage –æ—Ç—á—ë—Ç—ã

---

**–°–º. —Ç–∞–∫–∂–µ:**
- [TASKS.md](TASKS.md) - –∑–∞–¥–∞—á–∞ 5.1
- [CONTRIBUTING.md](CONTRIBUTING.md) - –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
