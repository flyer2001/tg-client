# –ó–∞–¥–∞—á–∏ –Ω–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ (TODO)

## üìù –†–µ–∑—é–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–µ—Å—Å–∏–∏

–ú—ã –∏—Å–ø—Ä–∞–≤–∏–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–±–ª–µ–º—É —Å –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–æ–µ–∫—Ç–∞ –≤ Xcode –∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:

**–ß—Ç–æ —Å–¥–µ–ª–∞–ª–∏:**
1. **–ò—Å–ø—Ä–∞–≤–∏–ª–∏ –æ—à–∏–±–∫—É –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –≤ Xcode** - –¥–æ–±–∞–≤–∏–ª–∏ —Ñ–ª–∞–≥ `-parse-as-library` –¥–ª—è executable target
2. **–ò—Å–ø—Ä–∞–≤–∏–ª–∏ —á—Ç–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è** - –ø–µ—Ä–µ—à–ª–∏ —Å `getenv()` –Ω–∞ `ProcessInfo.processInfo.environment`
3. **–û—Ç–∫–ª—é—á–∏–ª–∏ –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –ª–æ–≥–∏ TDLib** - –¥–æ–±–∞–≤–∏–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ `td_log.h`
4. **–î–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫** - –≤–∫–ª—é—á–∏–ª–∏ `td_log.h` –≤ `shim.h` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

## üóÇÔ∏è –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–º–º–∏—Ç–∞

### –ö–æ–º–º–∏—Ç 1: "Fix Xcode build and environment variables handling"
**–§–∞–π–ª—ã:** `Package.swift`, `Sources/App/main.swift`
```
Fix Xcode build and environment variables handling

- Add -parse-as-library flag to App target to fix Xcode compilation
- Replace getenv() with ProcessInfo.processInfo.environment for better reliability
- Simplify environment variable parsing logic
```

### –ö–æ–º–º–∏—Ç 2: "Reduce TDLib logging verbosity"
**–§–∞–π–ª—ã:** `Sources/CTDLib/shim.h`, `Sources/TDLibAdapter/TDLibAdapter.swift`
```
Reduce TDLib logging verbosity

- Include td_log.h header for global logging configuration
- Set TDLib log verbosity to 0 (fatal only) before client creation
- Redirect all TDLib logs to file instead of stderr

This eliminates verbose ANSI-colored logs in Xcode console while
keeping error logging in tdlib.log file.
```

---

## ‚úÖ –ó–∞–¥–∞—á–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å–µ—Å—Å–∏—é

### 1. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `main.swift`

#### 1.1 –°–æ–∑–¥–∞—Ç—å `EnvironmentService` –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `Sources/App/EnvironmentService.swift`
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª `EnvironmentServiceProtocol`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `ProcessInfoEnvironmentService` –¥–ª—è macOS/Linux
- [ ] –°–æ–∑–¥–∞—Ç—å `AppConfiguration` struct –¥–ª—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [ ] **–†–µ—à–∏—Ç—å:** –æ—Å—Ç–∞–≤–∏—Ç—å `stateDir` –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º?
  - **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `~/.tdlib` –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω
  - **–í–æ–ø—Ä–æ—Å –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è:** –∫—Ä–∏—Ç–∏—á–Ω–æ –ª–∏, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–∫–∞–∂–µ—Ç –ø—É—Ç—å?
- [ ] –ü–æ–¥—É–º–∞—Ç—å –æ –±—É–¥—É—â–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–µ Windows/Docker (XDG paths –Ω–∞ Linux)
  - Windows: `%USERPROFILE%\AppData\Local\tdlib`
  - Docker: `/var/lib/tdlib` –∏–ª–∏ `/app/data`
  - Linux XDG: `$XDG_DATA_HOME/tdlib`

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –°–µ–π—á–∞—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è macOS –∏ Linux –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è (—á–µ—Ä–µ–∑ `ProcessInfo` –∏ `FileManager`), –Ω–æ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –ø–æ–ª–µ–∑–Ω–∞ –¥–ª—è:
- –ë—É–¥—É—â–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥—Ä—É–≥–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–º–æ–∂–Ω–æ –º–æ–∫–Ω—É—Ç—å `EnvironmentServiceProtocol`)
- –ß–µ—Ç–∫–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

#### 1.2 –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥–∏–∞–ª–æ–≥–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- [ ] –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –∑–∞–ø—Ä–æ—Å–∞ credentials –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π struct/class `AuthenticationDialog`
- [ ] –ú–µ—Ç–æ–¥—ã: `askPhone()`, `askCode()`, `askPassword()`
- [ ] –í–æ–∑–º–æ–∂–Ω–æ, –¥–æ–±–∞–≤–∏—Ç—å `AuthenticationDialogProtocol` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç —Å –∫–æ–Ω—Å–æ–ª—å–Ω—ã–º –≤–≤–æ–¥–æ–º vs –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã (stdin, —Ñ–∞–π–ª, –∏ —Ç.–¥.)

#### 1.3 –£–ª—É—á—à–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ `getMe`
**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
```swift
while Date().timeIntervalSince(started) < 5 {
    if let obj = td.receive(timeout: 0.5), let type = obj["@type"] as? String {
        if type == "user" { ... }
    }
}
```
–≠—Ç–æ —Ç–æ–ø–æ—Ä–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è polling'–∞ —Å —Ç–∞–π–º–∞—É—Ç–æ–º.

**–ó–∞–¥–∞—á–∏:**
- [ ] –ò–∑—É—á–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –≤ TDLib –Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –∂–¥–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç
- [ ] –ò–∑—É—á–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º `@extra` –≤ TDLib –¥–ª—è request-response –ø–∞—Ç—Ç–µ—Ä–Ω–∞
- [ ] –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã:
  - Async continuation —Å timeout (`withTimeout`)
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `AsyncStream` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ updates
  - –°–æ–∑–¥–∞—Ç—å –æ—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤ —Å promise/future –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º
- [ ] –í–æ–∑–º–æ–∂–Ω–æ, —Ç–∞–∫–æ–π polling –±—É–¥–µ—Ç –Ω—É–∂–µ–Ω –≤ –±—É–¥—É—â–µ–º - –≤—ã–Ω–µ—Å—Ç–∏ –≤ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—É—é —Ñ—É–Ω–∫—Ü–∏—é

### 2. –†–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å C-–∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ (`shim.h`)

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- `Sources/CTDLib/shim.h` —Å–æ–¥–µ—Ä–∂–∏—Ç `#include <td/telegram/td_json_client.h>` –∏ `#include <td/telegram/td_log.h>`
- `Sources/CTDLib/module.modulemap` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–¥—É–ª—å

**–ß—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ:**
- –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º bridging —á–µ—Ä–µ–∑ module.modulemap?
- –ó–∞—á–µ–º –Ω—É–∂–µ–Ω –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π shim.h –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞?
- –ü–æ—á–µ–º—É –º—ã –¥–æ–±–∞–≤–∏–ª–∏ td_log.h –∏ –∫–∞–∫ —ç—Ç–æ –ø–æ–≤–ª–∏—è–ª–æ –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏?

#### 2.1 –ò–∑—É—á–∏—Ç—å –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º
- [ ] –ò–∑—É—á–∏—Ç—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `module.modulemap` –≤ Swift Package Manager
- [ ] –ü–æ–Ω—è—Ç—å —Ä–æ–ª—å `shim.h` –≤ bridging C-–±–∏–±–ª–∏–æ—Ç–µ–∫
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, –ø–æ—á–µ–º—É –º—ã –¥–æ–±–∞–≤–∏–ª–∏ `td_log.h`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ `shim.h`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ `module.modulemap` —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏
- [ ] –í–æ–∑–º–æ–∂–Ω–æ, –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª –≤ `CLAUDE.md` –ø—Ä–æ C interop

### 3. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `TDLibAdapter.swift`

**–¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- –ú–Ω–æ–≥–æ –ª–æ–≥–∏–∫–∏ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
- TDConfig –æ–ø—Ä–µ–¥–µ–ª—ë–Ω inline
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã TDLib –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã –≤ –∫–æ–¥–µ
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è deprecated —Ñ—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã

#### 3.1 –í—ã–Ω–µ—Å—Ç–∏ `TDConfig` –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª
- [ ] –°–æ–∑–¥–∞—Ç—å `Sources/TDLibAdapter/TDConfig.swift`
- [ ] –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç—É–¥–∞ struct `TDConfig`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∫ –∫–∞–∂–¥–æ–º—É –ø–æ–ª—é:
  - `apiId`: API ID –∏–∑ https://my.telegram.org/apps
  - `apiHash`: API Hash –∏–∑ https://my.telegram.org/apps
  - `stateDir`: –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö TDLib
  - `logPath`: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–æ–≤ TDLib

#### 3.2 –í—ã–Ω–µ—Å—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã TDLib –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
```swift
let request: [String: Any] = [
    "@type": "setTdlibParameters",
    "use_test_dc": false,
    "database_directory": config.stateDir + "/db",
    // ... 15+ —Å—Ç—Ä–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
]
```

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å `Sources/TDLibAdapter/TDLibParameters.swift`
- [ ] –°–æ–∑–¥–∞—Ç—å struct `TDLibParameters` —Å:
  - Static –º–µ—Ç–æ–¥ `buildParameters(from config: TDConfig) -> [String: Any]`
  - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –ø–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è inline —Ñ–æ—Ä–º–∞—Ç (TDLib >= 1.8.6 —Ç—Ä–µ–±—É–µ—Ç —ç—Ç–æ)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ changelog TDLib –ø—Ä–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ API –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏
- [ ] –û–±—ä—è—Å–Ω–∏—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É —Å—Ç–∞—Ä—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º (nested `parameters` object) –∏ –Ω–æ–≤—ã–º (inline)

**–°–ø—Ä–∞–≤–∫–∞:**
- TDLib 1.8.0-1.8.5: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `parameters`
- TDLib 1.8.6+: —Ç—Ä–µ–±—É—é—Ç inline –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º TDLib 1.8.56 (HEAD)

#### 3.3 –ò—Å–ø—Ä–∞–≤–∏—Ç—å deprecated —Ñ—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
**–¢–µ–∫—É—â–∏–µ warning'–∏:**
```
warning: 'td_set_log_verbosity_level' is deprecated
warning: 'td_set_log_file_path' is deprecated
```

**–ó–∞–¥–∞—á–∏:**
- [ ] –ò–∑—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é TDLib –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ `td_log.h` –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å deprecated —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–Ω–∞–ª–æ–≥–∏
- [ ] –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JSON-based API –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–æ–≤

**–ú–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
- `Sources/TDLibAdapter/TDLibAdapter.swift:29` - `td_set_log_verbosity_level(0)`
- `Sources/TDLibAdapter/TDLibAdapter.swift:31` - `td_set_log_file_path(pathPtr)`

#### 3.4 –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ñ–∞–π–ª—É —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å `TDLibClient`:
  - –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ (Swift-–æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ TDLib C API)
  - –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
  - Thread-safety (@unchecked Sendable –∏ –ø–æ—á–µ–º—É)
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `start()`:
  - –û–±—ä—è—Å–Ω–∏—Ç—å async/await –ø–∞—Ç—Ç–µ—Ä–Ω
  - –û–ø–∏—Å–∞—Ç—å, —á—Ç–æ –º–µ—Ç–æ–¥ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  - –û–±—ä—è—Å–Ω–∏—Ç—å continuation –∏ –∑–∞—á–µ–º –Ω—É–∂–µ–Ω `onReady` callback
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `receiveLoop()`:
  - –û–ø–∏—Å–∞—Ç—å state machine –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ TDLib
  - –î–æ–±–∞–≤–∏—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É —Å–æ—Å—Ç–æ—è–Ω–∏–π (ASCII –∏–ª–∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ docs)
  - –û–±—ä—è—Å–Ω–∏—Ç—å –∫–∞–∂–¥—ã–π authorization state:
    - `authorizationStateWaitTdlibParameters`
    - `authorizationStateWaitEncryptionKey`
    - `authorizationStateWaitPhoneNumber`
    - `authorizationStateWaitCode`
    - `authorizationStateWaitPassword`
    - `authorizationStateReady`
    - `authorizationStateClosed`
- [ ] –û–±—ä—è—Å–Ω–∏—Ç—å —Ñ–ª–∞–≥ `parametersSet`:
  - –ü–æ—á–µ–º—É –Ω—É–∂–µ–Ω
  - –ü—Ä–æ–±–ª–µ–º–∞ –¥–≤–æ–π–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  - –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É `updateAuthorizationState` –∏ –ø—Ä—è–º—ã–º –æ—Ç–≤–µ—Ç–æ–º
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç JSON-—Å–æ–æ–±—â–µ–Ω–∏–π TDLib:
  - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å `@type`
  - –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
  - –°—Å—ã–ª–∫–∞ –Ω–∞ TDLib API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å inline –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –Ω–µ–æ—á–µ–≤–∏–¥–Ω—ã–º –º–µ—Å—Ç–∞–º:
  - `await Task.yield()` - –∑–∞—á–µ–º –Ω—É–∂–µ–Ω
  - `@unchecked Sendable` - –ø–æ—á–µ–º—É –±–µ–∑–æ–ø–∞—Å–Ω–æ

#### 3.5 –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤
–ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —Ñ–∞–π–ª –≤—Å—ë –µ—â—ë –±–æ–ª—å—à–æ–π, —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:
- [ ] `TDLibClient.swift` - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å
- [ ] `TDLibClient+Authorization.swift` - extension —Å –ª–æ–≥–∏–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- [ ] `TDLibClient+Logging.swift` - extension —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üìå –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

**High Priority (—Å–¥–µ–ª–∞—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å):**
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å deprecated —Ñ—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (3.3)
2. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ TDLibAdapter (3.4) - –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–æ–¥–∞
3. –†–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å shim.h (2.1) - –±–∞–∑–æ–≤–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**Medium Priority:**
4. –í—ã–Ω–µ—Å—Ç–∏ TDConfig (3.1) - —É–ª—É—á—à–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É
5. –í—ã–Ω–µ—Å—Ç–∏ TDLib –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (3.2) - –¥–µ–ª–∞–µ—Ç –∫–æ–¥ —á–∏—â–µ
6. –°–æ–∑–¥–∞—Ç—å EnvironmentService (1.1) - —Ö–æ—Ä–æ—à–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**Low Priority (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å):**
7. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ AuthenticationDialog (1.2) - –∫–æ—Å–º–µ—Ç–∏–∫–∞
8. –£–ª—É—á—à–∏—Ç—å polling getMe (1.3) - —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ –∫—Ä–∞—Å–∏–≤–æ

---

## ü§î –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è

1. **stateDir –≤ EnvironmentService**: –æ—Å—Ç–∞–≤–∏—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º —Å –¥–µ—Ñ–æ–ª—Ç–æ–º –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º?
2. **–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã**: –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Windows –≤ –±—É–¥—É—â–µ–º?
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –Ω—É–∂–Ω–æ –ª–∏ –¥–æ–±–∞–≤–ª—è—Ç—å —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (debug mode)?
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ª–∏ –ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã? (–≤–ª–∏—è–µ—Ç –Ω–∞ –≤—ã–±–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-19
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-19
