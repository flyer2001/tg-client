# E2E: Получение непрочитанных сообщений из каналов

## Описание

E2E тест для сценария получения непрочитанных сообщений из каналов.

**User Story:** Получить список всех непрочитанных сообщений из подписанных Telegram каналов
для создания AI-дайджеста.

**Сценарий:** <doc:FetchUnreadMessages>

**Предусловия:**
- **КРИТИЧНО:** Пользователь уже авторизован в TDLib (сохранённая сессия в ~/.tdlib/)
- Для первой авторизации: запустите `swift run tg-client` и пройдите процедуру авторизации
- Введите номер телефона, OTP код, 2FA пароль (если требуется)
- После успешной авторизации сессия сохраняется в ~/.tdlib/
- Переменные окружения настроены:
- `TELEGRAM_API_ID`
- `TELEGRAM_API_HASH`
- У пользователя есть подписки на Telegram каналы
- В некоторых каналах есть непрочитанные сообщения

**Тип теста:** E2E

**Исходный код:** [`Tests/TgClientE2ETests/FetchUnreadMessagesScenarioTests.swift`](https://github.com/flyer2001/tg-client/blob/main/Tests/TgClientE2ETests/FetchUnreadMessagesScenarioTests.swift)

## Тестовые сценарии

### fetch Unread Messages From Real Channels

E2E тест: получение непрочитанных сообщений из реальных каналов.

**Что тестируем:**
- Полный цикл: авторизация → loadChats → getChat → фильтрация каналов → getChatHistory
- Структуру возвращаемых данных (SourceMessage)
- Корректность ссылок на сообщения (для публичных каналов)

**ПРИМЕЧАНИЕ:** E2E тест disabled по умолчанию. Запускайте вручную из Xcode по необходимости.

1. Создание TDLib клиента и загрузка config из переменных окружения

2. Запуск TDLib с авторизацией (если сессия сохранена в ~/.tdlib, авторизация пропускается)

⚠️ E2E тест предполагает что авторизация УЖЕ выполнена (сессия сохранена)

Если попали сюда - значит нужна интерактивная авторизация (сессия отсутствует)

3. Создание ChannelMessageSource

4. Получение непрочитанных сообщений

5. Проверка результата

Edge case: нет непрочитанных — это валидный сценарий

Проверяем структуру первого сообщения

chatId для каналов/супергрупп отрицательный (начинается с -100)

Для публичных каналов должна быть ссылка

---


## Topics

### Связанная документация

- <doc:TgClient>
