# MVP: Telegram Digest Bot

> **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-28
> **–°—Ç–∞—Ç—É—Å:** In Progress
> **–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:** 0.2.0
> **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-28 (—Å–µ—Å—Å–∏—è 11)

**–ì–æ—Ç–æ–≤–æ (v0.2.0):**
- ‚úÖ TDLibAdapter —Å Race Condition fix (sendAndWait)
- ‚úÖ ChannelMessageSource (—Å–±–æ—Ä –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞–Ω–∞–ª–æ–≤)
- ‚úÖ 128 Unit/Component —Ç–µ—Å—Ç–æ–≤, E2E —Ç–µ—Å—Ç
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ macOS + Linux

**–î–µ—Ç–∞–ª–∏:** –°–º. [CHANGELOG.md](CHANGELOG.md)

---

## üéØ –ü—Ä–æ–¥—É–∫—Ç–æ–≤–æ–µ –≤–∏–¥–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –≤ Telegram –∫–∞–Ω–∞–ª–∞—Ö: –¥–µ—Å—è—Ç–∫–∏ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å.

### –†–µ—à–µ–Ω–∏–µ
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–∞–π–¥–∂–µ—Å—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∫–∞–Ω–∞–ª–æ–≤ —Å AI-—Å–∞–º–º–∞—Ä–∏, –¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–π —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ 2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å + –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é.

### –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è (MVP)
- –ê–≤—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞
- –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (1-2 —á–µ–ª–æ–≤–µ–∫–∞)

---

## ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª MVP (Must Have)

### 1. –°–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∫–∞–Ω–∞–ª–æ–≤
- **Scope:** –¢–æ–ª—å–∫–æ Telegram –∫–∞–Ω–∞–ª—ã (–Ω–µ –≥—Ä—É–ø–ø—ã, –Ω–µ –ª–∏—á–Ω—ã–µ —á–∞—Ç—ã)
- **–§–∏–ª—å—Ç—Ä:** –ö–∞–Ω–∞–ª—ã –ù–ï –Ω–∞—Ö–æ–¥—è—â–∏–µ—Å—è –≤ –∞—Ä—Ö–∏–≤–µ
- **–¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π:** –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç
- **–õ–∏–º–∏—Ç—ã:** –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É (–≤ —Ä–∞–º–∫–∞—Ö –ª–∏–º–∏—Ç–∞ TG API)

**–ë—É–¥—É—â–µ–µ —É–ª—É—á—à–µ–Ω–∏–µ:** Whitelist –∫–∞–Ω–∞–ª–æ–≤ (–µ—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ–π UX –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

### 2. AI –°–∞–º–º–∞—Ä–∏–∑–∞—Ü–∏—è (OpenAI)
- **–ü—Ä–æ–≤–∞–π–¥–µ—Ä:** OpenAI API (GPT-4 –∏–ª–∏ GPT-3.5-turbo)
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è `SummaryGeneratorProtocol` –¥–ª—è —Å–º–µ–Ω—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- **–§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞:**
  - –ö—Ä–∞—Ç–∫–æ–µ —Å–∞–º–º–∞—Ä–∏ –≤ –Ω–∞—á–∞–ª–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
  - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞–Ω–∞–ª–∞–º
  - –°—Å—ã–ª–∫–∏ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
  - –ú–∞–∫—Å–∏–º—É–º 4096 —Å–∏–º–≤–æ–ª–æ–≤ (–ª–∏–º–∏—Ç Telegram API –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è)
  - –ï—Å–ª–∏ –±–æ–ª—å—à–µ ‚Üí —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π
- **–§–æ—Ä–º–∞—Ç:** Telegram Markdown (–∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç, –∫—É—Ä—Å–∏–≤, —Å—Å—ã–ª–∫–∏)

### 3. –î–æ—Å—Ç–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Telegram Bot
- **–ö—É–¥–∞:** –õ–∏—á–Ω—ã–π —á–∞—Ç —Å –±–æ—Ç–æ–º (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –±–æ—Ç)
- **–§–æ—Ä–º–∞—Ç:** Telegram MarkdownV2
- **–†–µ–∂–∏–º—ã –∑–∞–ø—É—Å–∫–∞:**
  - **Scheduled:** 2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å (cron)
  - **On-demand:** –ö–æ–º–∞–Ω–¥–∞ `/digest` –≤ –±–æ—Ç–µ

### 4. –û—Ç–º–µ—Ç–∫–∞ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º
- **–ö–æ–≥–¥–∞:** –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤—Å–µ—Ö —Å–∞–º–º–∞—Ä–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- **–ö–∞–∫:** TDLib API `viewMessages` –¥–ª—è –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
- **Rollback:** –ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–µ–π–ª–∏—Ç—Å—è ‚Üí –ù–ï –ø–æ–º–µ—á–∞—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º

### 5. –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ:** Timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–π —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–§–æ—Ä–º–∞—Ç:** JSON —Ñ–∞–π–ª `~/.tdlib/digest_state.json`
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
  ```json
  {
    "last_successful_run": "2025-10-28T14:30:00Z",
    "last_message_id_by_chat": {
      "chat_12345": 67890
    }
  }
  ```

### 6. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
  - Structured logging (JSON) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
  - –£—Ä–æ–≤–Ω–∏: DEBUG, INFO, WARN, ERROR
  - –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ (logrotate)
- **–ê–ª–µ—Ä—Ç—ã —á–µ—Ä–µ–∑ TG –±–æ—Ç:**
  - –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  - –û—à–∏–±–∫–∞ AI API (timeout, quota, 5xx)
  - –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –±–æ—Ç–∞
  - –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–π cron –∑–∞–ø—É—Å–∫ (heartbeat)
- **Healthcheck:**
  - –°–∫—Ä–∏–ø—Ç `/usr/local/bin/digest-healthcheck.sh`
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ heartbeat (—Ñ–∞–π–ª —Å timestamp)
  - Cron –∑–∞–¥–∞—á–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### 7. Deployment
- **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:** Linux VPS (Ubuntu/Debian)
- **–†–µ–∂–∏–º:** systemd service + cron –¥–ª—è scheduled –∑–∞–ø—É—Å–∫–æ–≤
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (credentials, API keys)
- **–õ–æ–≥–∏:** Centralized logging —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

---

## üö´ –ù–µ –≤—Ö–æ–¥–∏—Ç –≤ MVP (Future Features)

### –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —Ñ–∏—á–∏ (v0.2.0+)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞ (—Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ, –¥–æ–∫—É–º–µ–Ω—Ç—ã) ‚Üí —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è
- –ß—Ç–µ–Ω–∏–µ –≥—Ä—É–ø–ø —Å –¥–∏–∞–ª–æ–≥–∞–º–∏ (threading)
- –û–±—Å—É–∂–¥–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –∫–∞–Ω–∞–ª–æ–≤ (comments)
- –õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (DM)
- Whitelist/Blacklist UI —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å—Ç–æ—Ç—ã —á–µ—Ä–µ–∑ –±–æ—Ç–∞ (—Å–µ–π—á–∞—Å hardcoded 2 —Ä–∞–∑–∞/–¥–µ–Ω—å)
- –≠–∫—Å–ø–æ—Ä—Ç –≤ –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã (email, RSS)
- –ò—Å—Ç–æ—Ä–∏—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ (–∞—Ä—Ö–∏–≤)
- –ü–æ–∏—Å–∫ –ø–æ —Å—Ç–∞—Ä—ã–º –¥–∞–π–¥–∂–µ—Å—Ç–∞–º
- –¢–µ–≥–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –∫–∞–Ω–∞–ª–æ–≤
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Å–∞–º–º–∞—Ä–∏ (—Ç–æ–Ω, –¥–ª–∏–Ω–∞, —è–∑—ã–∫)

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (Backlog)
- –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus + Grafana)
- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- Multi-user –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –æ–¥–Ω–æ–º –∏–Ω—Å—Ç–∞–Ω—Å–µ)
- Docker –æ–±—Ä–∞–∑ –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –¥–µ–ø–ª–æ—è
- Horizontal scaling (queue-based processing)

---

## üìã –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è MVP

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–º–æ–¥—É–ª–∏)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    DigestOrchestrator                   ‚îÇ
‚îÇ              (main entry point, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä)            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚ñº                  ‚ñº                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ MessageSource ‚îÇ  ‚îÇSummaryGenerator‚îÇ  ‚îÇ BotNotifier  ‚îÇ
‚îÇ (Channels MVP)‚îÇ  ‚îÇ   (OpenAI)    ‚îÇ  ‚îÇ  (TG Bot API)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                  ‚îÇ                  ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚ñº
                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                  ‚îÇ  StateManager   ‚îÇ
                  ‚îÇ (timestamp JSON)‚îÇ
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚ñº
                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                  ‚îÇ MonitoringService‚îÇ
                  ‚îÇ  (alerts, logs) ‚îÇ
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. MessageSource (Channel Implementation)
- –ü—Ä–æ—Ç–æ–∫–æ–ª: `MessageSourceProtocol` (–∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —á–∞—Ç–æ–≤)
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: `ChannelMessageSource` (MVP - —Ç–æ–ª—å–∫–æ –∫–∞–Ω–∞–ª—ã)
- –ë—É–¥—É—â–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: `GroupChatMessageSource`, `PrivateChatMessageSource`
- –ú–µ—Ç–æ–¥—ã:
  - `fetchUnreadMessages(since: Date?) async throws -> [SourceMessage]`
  - `markAsRead(messages: [SourceMessage]) async throws`

##### TDLib API: –†–∞–±–æ—Ç–∞ —Å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

> **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è TDLib:** https://core.telegram.org/tdlib/.claude/

**–ú–µ—Ö–∞–Ω–∏–∑–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö:**

TDLib –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ—Å—Ç–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ Telegram. –ö–∞–∂–¥—ã–π —á–∞—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:

- `unreadCount: Int` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º)
- `lastReadInboxMessageId: Int64` ‚Äî ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- `lastReadOutboxMessageId: Int64` ‚Äî ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–¥–ª—è –ª–∏—á–Ω—ã—Ö —á–∞—Ç–æ–≤)

**–ú–µ—Ç–æ–¥—ã TDLib API:**

1. **`getChatHistory(chatId:, fromMessageId:, offset:, limit:)`** ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Messages`
   - `fromMessageId: Int64` ‚Äî ID —Å–æ–æ–±—â–µ–Ω–∏—è, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞—á–∞—Ç—å (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ)
   - `offset: Int` ‚Äî —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ fromMessageId (–æ–±—ã—á–Ω–æ 0)
   - `limit: Int` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è
   - –°–æ–æ–±—â–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ **–æ–±—Ä–∞—Ç–Ω–æ–º —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ** (–Ω–æ–≤—ã–µ ‚Üí —Å—Ç–∞—Ä—ã–µ)
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://core.telegram.org/tdlib/.claude/classtd_1_1td__api_1_1get_chat_history.html

2. **`viewMessages(chatId:, messageIds:, forceRead:)`** ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Ok`
   - –û—Ç–º–µ—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ (–æ–±–Ω–æ–≤–ª—è–µ—Ç `lastReadInboxMessageId`)
   - `forceRead: true` ‚Äî –æ—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ (–Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ)
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://core.telegram.org/tdlib/.claude/classtd_1_1td__api_1_1view_messages.html

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –±–µ–∑ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**

TDLib –Ω–µ –∏–º–µ–µ—Ç –º–µ—Ç–æ–¥–∞ "–¥–∞–π —Ç–æ–ª—å–∫–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ", –Ω–æ –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å:

```swift
// –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —á–∞—Ç–µ
let chats = try await tdlib.send(GetChatsRequest(chatList: .main, limit: 100))
let unreadChannels = chats.filter { $0.type == .channel && $0.unreadCount > 0 }

// –®–∞–≥ 2: –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
for channel in unreadChannels {
    // –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Ä–æ–≤–Ω–æ unreadCount —Å–æ–æ–±—â–µ–Ω–∏–π, –Ω–∞—á–∏–Ω–∞—è —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ
    let history = try await tdlib.send(
        GetChatHistoryRequest(
            chatId: channel.id,
            fromMessageId: 0,  // 0 = –Ω–∞—á–∞—Ç—å —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
            offset: 0,
            limit: channel.unreadCount
        )
    )

    // –§–∏–ª—å—Ç—Ä –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ (–∑–∞—â–∏—Ç–∞ –æ—Ç race condition)
    let unreadMessages = history.messages.filter {
        $0.id > channel.lastReadInboxMessageId
    }

    // –í—Å–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏ (–µ—Å–ª–∏ unreadCount —Ç–æ—á–Ω—ã–π)
}

// –®–∞–≥ 3: –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–π–¥–∂–µ—Å—Ç–∞
try await tdlib.send(
    ViewMessagesRequest(
        chatId: channel.id,
        messageIds: unreadMessages.map { $0.id },
        forceRead: true
    )
)
```

**–í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:**

- ‚ö†Ô∏è **Race condition:** –º–µ–∂–¥—É `loadChats` –∏ `getChatHistory` –∫—Ç–æ-—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí –≤—Å–µ–≥–¥–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ `lastReadInboxMessageId`
- ‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:** –∏—Å–ø–æ–ª—å–∑—É—è `limit: unreadCount` –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ–º —Ç—Ä–∞—Ñ–∏–∫
- ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å:** —Ñ–∏–ª—å—Ç—Ä –ø–æ `messageId > lastReadInboxMessageId` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å

**–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:**

```swift
// –î–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ (—Å username)
let link = "https://t.me/\(channel.username)/\(message.id)"

// –î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ (–±–µ–∑ username)
// –¢—Ä–µ–±—É–µ—Ç invite link, –≤ MVP ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "Private channel"
```

#### 2. SummaryGenerator
- –ü—Ä–æ—Ç–æ–∫–æ–ª: `SummaryGeneratorProtocol`
- –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
  - `OpenAISummaryGenerator` (MVP)
  - `ClaudeSummaryGenerator` (future)
  - `MockSummaryGenerator` (tests)
- –ú–µ—Ç–æ–¥—ã:
  - `generateSummary(messages:, maxLength:) async throws -> DigestSummary`

#### 3. BotNotifier
- –ü—Ä–æ—Ç–æ–∫–æ–ª: `BotNotifierProtocol`
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: `TelegramBotNotifier`
- –ú–µ—Ç–æ–¥—ã:
  - `send(summary:, chatId:) async throws`
  - `sendAlert(error:, chatId:) async throws`

#### 4. StateManager
- –ü—Ä–æ—Ç–æ–∫–æ–ª: `StateManagerProtocol`
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: `FileBasedStateManager`
- –ú–µ—Ç–æ–¥—ã:
  - `loadState() throws -> DigestState`
  - `saveState(_:) throws`
  - `getLastRunTimestamp() -> Date?`
  - `updateLastRun(_:) throws`

#### 5. MonitoringService
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `swift-log` + structured JSON
- –ê–ª–µ—Ä—Ç—ã: —á–µ—Ä–µ–∑ `BotNotifier`
- Healthcheck: heartbeat —Ñ–∞–π–ª + cron

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

```swift
struct DigestState: Codable {
    let lastSuccessfulRun: Date
    let lastMessageIdByChat: [Int64: Int64]
}

struct Message {
    let id: Int64
    let chatId: Int64
    let chatTitle: String
    let text: String
    let date: Date
    let link: String  // t.me/channel/123
}

struct DigestSummary {
    let summary: String  // –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
    let channelSummaries: [ChannelSummary]
    let totalMessages: Int
    let periodStart: Date
    let periodEnd: Date
}

struct ChannelSummary {
    let chatId: Int64
    let chatTitle: String
    let messageCount: Int
    let summary: String
    let messageLinks: [String]
}
```

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```swift
// Package.swift
dependencies: [
    .package(url: "https://github.com/apple/swift-log.git", from: "1.6.4"),
    // OpenAI SDK - TBD (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä—è–º—ã–µ HTTP calls)
]
```

### Environment Variables

```bash
# Telegram Client (TDLib)
TELEGRAM_API_ID=...
TELEGRAM_API_HASH=...
TELEGRAM_PHONE=...

# Telegram Bot (–¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏)
TELEGRAM_BOT_TOKEN=...
TELEGRAM_BOT_CHAT_ID=...  # –∫—É–¥–∞ —Å–ª–∞—Ç—å –¥–∞–π–¥–∂–µ—Å—Ç—ã

# OpenAI
OPENAI_API_KEY=...
OPENAI_MODEL=gpt-4-turbo  # –∏–ª–∏ gpt-3.5-turbo

# State
DIGEST_STATE_DIR=~/.tdlib

# Monitoring
DIGEST_ALERT_CHAT_ID=...  # –∫—É–¥–∞ —Å–ª–∞—Ç—å –∞–ª–µ—Ä—Ç—ã (–º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ—Ç –∂–µ —á—Ç–æ –∏ –¥–∞–π–¥–∂–µ—Å—Ç—ã)
```

---

## üé¨ User Flow (MVP)

### Scheduled Run (Cron)

```
1. Cron –∑–∞–ø—É—Å–∫–∞–µ—Ç `tg-digest scheduled` (2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å: 09:00, 18:00)
2. DigestOrchestrator:
   a. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞
   b. MessageSource –ø–æ–ª—É—á–∞–µ—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∫–∞–Ω–∞–ª–æ–≤ (–Ω–µ –≤ –∞—Ä—Ö–∏–≤–µ)
   c. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—Å–ª–µ last_message_id
   d. SummaryGenerator —Å–æ–∑–¥–∞–µ—Ç AI-—Å–∞–º–º–∞—Ä–∏
   e. BotNotifier –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ TG –±–æ—Ç–∞
   f. –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ ‚Üí MessageSource.markAsRead –¥–ª—è –≤—Å–µ—Ö –∫–∞–Ω–∞–ª–æ–≤
   g. –û–±–Ω–æ–≤–ª—è–µ—Ç timestamp –≤ StateManager
3. Healthcheck –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç heartbeat
4. –ü—Ä–∏ –æ—à–∏–±–∫–µ ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–∞ —á–µ—Ä–µ–∑ BotNotifier
```

### On-Demand Run (Telegram Bot)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/digest` –≤ –±–æ—Ç–∞
2. Bot webhook –≤—ã–∑—ã–≤–∞–µ—Ç `tg-digest on-demand`
3. –¢–æ—Ç –∂–µ flow —á—Ç–æ –∏ scheduled, –Ω–æ:
   - –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç timestamp (–≤—Å–µ–≥–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ)
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å "–ì–µ–Ω–µ—Ä–∏—Ä—É—é –¥–∞–π–¥–∂–µ—Å—Ç..." —Å—Ä–∞–∑—É
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ MVP

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [ ] –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è TDLib –∫–ª–∏–µ–Ω—Ç–∞
- [ ] –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ (–Ω–µ –≤ –∞—Ä—Ö–∏–≤–µ)
- [ ] –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Å—Å—ã–ª–∫–∞–º–∏
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è AI-—Å–∞–º–º–∞—Ä–∏ —á–µ—Ä–µ–∑ OpenAI API
- [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–π–¥–∂–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞
- [ ] –û—Ç–º–µ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (timestamp)
- [ ] Scheduled –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ cron (2 —Ä–∞–∑–∞/–¥–µ–Ω—å)
- [ ] On-demand –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ (`/digest`)
- [ ] –ê–ª–µ—Ä—Ç—ã –≤ TG –±–æ—Ç –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [ ] TDD: –º–∏–Ω–∏–º—É–º 80% code coverage –¥–ª—è core –ª–æ–≥–∏–∫–∏
- [ ] Structured logging (JSON) –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] Healthcheck —Å–∫—Ä–∏–ø—Ç + cron –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] systemd service –¥–ª—è Linux VPS
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–µ–ø–ª–æ—è (DEPLOY.md –æ–±–Ω–æ–≤–ª–µ–Ω)
- [ ] –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ª–æ–≥–æ–≤ (—Å–∫—Ä–∏–ø—Ç—ã)

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] README.md –æ–±–Ω–æ–≤–ª–µ–Ω (quick start)
- [ ] DEPLOY.md –æ–±–Ω–æ–≤–ª–µ–Ω (systemd + cron setup)
- [ ] TROUBLESHOOTING.md (—á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ + –ª–æ–≥–∏)
- [ ] –ü—Ä–∏–º–µ—Ä—ã environment variables (.env.example)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] Unit-—Ç–µ—Å—Ç—ã –¥–ª—è SummaryGenerator (–º–æ–∫–∏ OpenAI)
- [ ] Unit-—Ç–µ—Å—Ç—ã –¥–ª—è ChannelFetcher (–º–æ–∫–∏ TDLib)
- [ ] Unit-—Ç–µ—Å—Ç—ã –¥–ª—è StateManager
- [ ] Component-—Ç–µ—Å—Ç—ã –¥–ª—è DigestOrchestrator
- [ ] Manual E2E —Ç–µ—Å—Ç –Ω–∞ VPS (–ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª)

---

## üöÄ –ü–ª–∞–Ω –≤—ã—Ö–æ–¥–∞ MVP (Roadmap)

### Phase 1: Core Components (2-3 –Ω–µ–¥–µ–ª–∏)
1. **ChannelFetcher** (TDLib integration)
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–æ–≤
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è (–Ω–µ –≤ –∞—Ä—Ö–∏–≤–µ)
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
   - –û—Ç–º–µ—Ç–∫–∞ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º
2. **SummaryGenerator** (OpenAI integration)
   - OpenAI API client
   - –ü—Ä–æ–º–ø—Ç –¥–ª—è —Å–∞–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏
   - Handling –ª–∏–º–∏—Ç–æ–≤ (4096 —Å–∏–º–≤–æ–ª–æ–≤)
3. **BotNotifier** (Telegram Bot API)
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
   - Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   - Error handling

### Phase 2: Orchestration & State (1 –Ω–µ–¥–µ–ª—è)
4. **StateManager** (persistence)
   - JSON —Ñ–∞–π–ª —Å timestamp
   - Load/Save –æ–ø–µ—Ä–∞—Ü–∏–∏
5. **DigestOrchestrator** (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è)
   - –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - Error handling –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
   - Rollback –ª–æ–≥–∏–∫–∞

### Phase 3: Deployment & Monitoring (1 –Ω–µ–¥–µ–ª—è)
6. **MonitoringService**
   - Structured logging
   - –ê–ª–µ—Ä—Ç—ã —á–µ—Ä–µ–∑ TG –±–æ—Ç
   - Healthcheck —Å–∫—Ä–∏–ø—Ç
7. **Deployment**
   - systemd service
   - cron setup
   - –õ–æ–≥–∏ + —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

### Phase 4: Testing & Documentation (1 –Ω–µ–¥–µ–ª—è)
8. **Testing**
   - Unit-—Ç–µ—Å—Ç—ã (80% coverage)
   - E2E —Ç–µ—Å—Ç—ã
9. **Documentation**
   - DEPLOY.md
   - TROUBLESHOOTING.md
   - README.md

**–ò—Ç–æ–≥–æ:** ~6 –Ω–µ–¥–µ–ª—å –¥–æ –≥–æ—Ç–æ–≤–æ–≥–æ MVP

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞ (–ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞)

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏
- Uptime > 99% (–∑–∞ –º–µ—Å—è—Ü)
- Successful runs > 95% (cron –∑–∞–ø—É—Å–∫–∏)
- API errors < 5% (OpenAI + TG Bot)
- Avg processing time < 2 –º–∏–Ω—É—Ç—ã (per run)

### –ü—Ä–æ–¥—É–∫—Ç–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ –≤ –¥–µ–Ω—å: 2 (scheduled) + N (on-demand)
- –°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–∞–ª–æ–≤ –≤ –¥–∞–π–¥–∂–µ—Å—Ç–µ: X
- –°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–∞–π–¥–∂–µ—Å—Ç–µ: Y
- User feedback: "–ø–æ–ª–µ–∑–Ω–æ" vs "–Ω–µ —á–∏—Ç–∞—é"

---

## ü§î –û—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

1. **OpenAI SDK:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É –∏–ª–∏ –ø–∏—Å–∞—Ç—å HTTP client?
   - –ü–ª—é—Å—ã SDK: –º–µ–Ω—å—à–µ –∫–æ–¥–∞, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ retry/timeout
   - –ú–∏–Ω—É—Å—ã SDK: –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ breaking changes

2. **Telegram Bot —Ä–µ–∂–∏–º:** Webhook vs Long Polling?
   - Webhook: —Ç—Ä–µ–±—É–µ—Ç HTTPS, –±—ã—Å—Ç—Ä–µ–µ
   - Long Polling: –ø—Ä–æ—â–µ setup, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è MVP

3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤:** JSON —Å—Ç—Ä–æ–∫–∏ –∏–ª–∏ structured fields?
   - JSON: –ª–µ–≥—á–µ –ø–∞—Ä—Å–∏—Ç—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
   - Structured: —á–∏—Ç–∞–±–µ–ª—å–Ω–µ–µ –¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞

4. **Deployment:** Docker –∏–ª–∏ –Ω–∞—Ç–∏–≤–Ω—ã–π systemd?
   - Docker: easier replication, isolated env
   - Systemd: lighter, faster startup

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è MVP:**
- OpenAI: –ø—Ä—è–º—ã–µ HTTP calls (–º–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
- Bot: Long Polling (–ø—Ä–æ—â–µ –¥–ª—è MVP)
- Logs: JSON —Å—Ç—Ä–æ–∫–∏ (–¥–ª—è –±—É–¥—É—â–µ–≥–æ Prometheus/Loki)
- Deployment: systemd (–º–µ–Ω—å—à–µ overhead –¥–ª—è single user)

---

**–°–æ–∑–¥–∞—Ç–µ–ª—å:** @flyer2001
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-28
