# –†–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤–∞: Outside-In TDD Process Improvements

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-19
**–°—Ç–∞—Ç—É—Å:** –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ (–ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è MVP-1.6)
**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** ~2-3 —á–∞—Å–∞

---

## üéØ –¶–µ–ª—å

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –≤ —Ç–µ–∫—É—â–µ–º –ø—Ä–æ—Ü–µ—Å—Å–µ Outside-In TDD –∏ –≤—ã—Ä–∞–±–æ—Ç–∞—Ç—å —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–∑–¥–Ω–∏—Ö —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–≤ –∏ –∫—Ä—É–ø–Ω—ã—Ö –±–∞–≥–æ–≤.

---

## üìù –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è (–æ—Ç Product Owner)

### 1. –ü–æ–∑–¥–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

**–ü—Ä–æ–±–ª–µ–º–∞:**
> –ú—ã –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ –æ—á–µ–Ω—å –ø–æ–∑–¥–Ω–æ —á—Ç–æ —É –Ω–∞—Å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫—Ä–∏–≤–æ TDLibClient –∏ –ª–æ–≥–∏–∫–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —á–∞—Ç–æ–≤. –í –∏—Ç–æ–≥–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Ç–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –º—ã —É–∂–µ –¥–∞–∂–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏ (–≤–æ–ø—Ä–æ—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞–ø—Ä–∏–º–µ—Ä).

**–í–æ–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:**
- –ü–æ—á–µ–º—É race condition –≤ TDLibClient (–¥–≤–∞ receive loops) –æ–±–Ω–∞—Ä—É–∂–∏–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ loadChats?
- –ú–æ–≥–ª–∏ –ª–∏ E2E —Ç–µ—Å—Ç—ã –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –≤—ã—è–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Ä–∞–Ω—å—à–µ?
- –ö–∞–∫ —É–ª—É—á—à–∏—Ç—å coverage E2E —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è concurrency –ø—Ä–æ–±–ª–µ–º?

### 2. –ù–µ–¥–æ–æ—Ü–µ–Ω–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ –±–∞–≥–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:**
> –ú–Ω–µ –Ω–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å, —á—Ç–æ continuation leak —Ç—ã –æ–ø–∏—Å–∞–ª –º–Ω–µ, –∫–∞–∫ –Ω–µ–≤–∞–∂–Ω—É—é –æ—à–∏–±–∫—É, –∞ –æ–Ω–∞ –ª–æ–º–∞–ª–∞ –Ω–∞–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã).

**–í–æ–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:**
- –ü–æ—á–µ–º—É continuation leak –±—ã–ª–∞ –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ "–ù–ï –∫—Ä–∏—Ç–∏—á–Ω–æ" –≤ ADR-002?
- –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –±–∞–≥–æ–≤ –≤ concurrency –∫–æ–¥–µ?
- –ù—É–∂–Ω–∞ –ª–∏ –º–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è –±–∞–≥–æ–≤ (data loss, deadlock, memory leak)?

### 3. Outside-In TDD –∏ cascade changes

**–ü—Ä–æ–±–ª–µ–º–∞:**
> –í–æ–∑–º–æ–∂–Ω–æ –Ω–∞–º —Å—Ç–æ–∏—Ç –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–∞–º –ø—Ä–æ—Ü–µ—Å—Å TDD Outside-In –ø–æ—Ç–æ–º—É —á—Ç–æ –∫–∞–∂–¥–∞—è —Å–ª–µ–¥—É—é—â–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –∑–∞–¥–µ–≤–∞–µ—Ç –æ—á–µ–Ω—å –º–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–∑–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–æ–≤ –∑–∞–¥–µ–ª–∞ –∏ —Å–ª–æ–º–∞–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é).

**–í–æ–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:**
- –ù—É–∂–Ω—ã –ª–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ E2E regression —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏?
- –ö–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å E2E —Ç–µ—Å—Ç—ã —á—Ç–æ–±—ã –æ–Ω–∏ –ø–æ–∫—Ä—ã–≤–∞–ª–∏ –≤—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—É—Ç–∏ (auth, loadChats, getChatHistory)?
- –ö–∞–∫ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å cascade changes –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞?

### 4. Overhead –æ—Ç MockClient: –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ Real –∫–ª–∏–µ–Ω—Ç–∞

**–ü—Ä–æ–±–ª–µ–º–∞:**
> –ú–Ω–µ –Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, —á—Ç–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è MockClient –≤ —Å–ª—É—á–∞–µ —Ç–∞–∫–æ–≥–æ –±–æ–ª—å—à–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∞—Å –¥—É–º–∞—Ç—å –∏ –Ω–∞–¥ –Ω–∏–º —Ç–æ–∂–µ.

**–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä (2025-11-21):**
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ TDLibClient: ResponseWaiters ‚Üí actor, TDLibJSON wrapper
- MockTDLibClient –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ResponseWaiters ‚Üí –¥—É–±–ª–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É
- –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞: 2 Mock —Ç–µ—Å—Ç–∞ —Å–ª–æ–º–∞–Ω—ã, –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- **Root cause:** MockClient –∏–º–∏—Ç–∏—Ä—É–µ—Ç –≤–µ—Å—å TDLibClient, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ C API boundary

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥:**
–í–º–µ—Å—Ç–æ Mock TDLibClient ‚Üí Mock —Ç–æ–ª—å–∫–æ `td_json_client_*` C —Ñ—É–Ω–∫—Ü–∏–∏:
```swift
// ‚ùå –¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥: Mock –≤–µ—Å—å TDLibClient
class MockTDLibClient: TDLibClientProtocol {
    // –î—É–±–ª–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É ResponseWaiters, updates loop, etc.
}

// ‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Mock —Ç–æ–ª—å–∫–æ C API boundary
class MockTDLibCClient {
    func td_json_client_receive(timeout: Double) -> String? { ... }
    func td_json_client_send(request: String) { ... }
}
// Real TDLibClient –∏—Å–ø–æ–ª—å–∑—É–µ—Ç MockTDLibCClient –≤ —Ç–µ—Å—Ç–∞—Ö
```

**–í–æ–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:**
- –ù—É–∂–µ–Ω –ª–∏ MockClient –≤–æ–æ–±—â–µ –¥–ª—è Component —Ç–µ—Å—Ç–æ–≤ –∏–ª–∏ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π TDLibClient?
- –ú–æ–∂–Ω–æ –ª–∏ –º–æ–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ C API boundary (`td_json_client_*` —Ñ—É–Ω–∫—Ü–∏–∏) –≤–º–µ—Å—Ç–æ –≤—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞?
- –ú–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á–∞—Å—Ç–∏ Real implementation –≤ Mock (–Ω–∞–ø—Ä–∏–º–µ—Ä, ResponseWaiters)?
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Integration —Ç–µ—Å—Ç—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º TDLib –≤–º–µ—Å—Ç–æ Mock'–æ–≤?

**–î–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [ ] –ü–æ—á–∏–Ω–∏—Ç—å 2 Mock —Ç–µ—Å—Ç–∞ (ChannelMessageSourceTests) - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π TDLibClient
- [ ] –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ MockClient: –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ResponseWaiters –∏–∑ Real implementation

### 5. Actor vs NSLock: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç –≤—ã–±–æ—Ä

**–ü—Ä–æ–±–ª–µ–º–∞:**
> –ú–Ω–µ –Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, —á—Ç–æ —Ç—ã –ø–∏—Ö–∞–µ—à—å —Å–Ω–∞—á–∞–ª–∞ –≤–µ–∑–¥–µ actor –∞ –ø–æ—Ç–æ–º –º—ã –ø–µ—Ä–µ–¥–µ–ª—ã–≤–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º lock.

**–í–æ–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:**
- –ü–æ—á–µ–º—É actor –±—ã–ª –≤—ã–±—Ä–∞–Ω –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç –¥–ª—è concurrency?
- –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å actor, –∫–æ–≥–¥–∞ NSLock, –∫–æ–≥–¥–∞ OSAllocatedUnfairLock?
- –ù—É–∂–Ω–∞ –ª–∏ decision tree –¥–ª—è –≤—ã–±–æ—Ä–∞ concurrency primitive –≤ Swift 6?

### 6. ADR: –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏—á–∏–Ω—ã –ø–æ—è–≤–ª–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
> –ú—ã –Ω–∞–ø–∏—Å–∞–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ ADR - –æ–Ω–∏ —á—Ä–µ–∑–º–µ—Ä–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–µ, –Ω–æ –¥–∞–≤–∞–π –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏—á–∏–Ω—ã –∏—Ö –ø–æ—è–≤–ª–µ–Ω–∏—è –∏ –º–æ–≥–ª–∏ –ª–∏ –º—ã —Ä–∞–Ω—å—à–µ –µ–µ –≤—ã—è–≤–∏—Ç—å.

**–í–æ–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:**
- ADR-001 (fetchUnreadMessages): –ø–æ—á–µ–º—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–µ –±—ã–ª —Å–¥–µ–ª–∞–Ω –¥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏?
- ADR-002 (Unified Background Loop): race condition - –º–æ–≥–ª–∏ –ª–∏ –≤—ã—è–≤–∏—Ç—å —á–µ—Ä–µ–∑ code review?
- –ù—É–∂–µ–Ω –ª–∏ lightweight ADR —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤?

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã (–æ—Ç Senior Architect)

### 7. Test Coverage –∏ Concurrency

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –£ –Ω–∞—Å –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (10x getChatHistory –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
- E2E —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç race conditions
- Component —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Mock –≤–º–µ—Å—Ç–æ async —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å Concurrency Stress Tests (100 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Thread Sanitizer –≤ CI
- E2E —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π TDLib, –∞ –Ω–µ Mock

### 8. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è: –∫–æ–≥–¥–∞ –¥–µ–ª–∞—Ç—å –∞–Ω–∞–ª–∏–∑?

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–µ–ª–∞–µ—Ç—Å—è –ü–û–°–õ–ï —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–≤ ADR)
- Outside-In TDD —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö, –Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç internal concurrency

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:**
- "Architecture First" –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å concurrency (TDLibClient, ChannelMessageSource)
- Lightweight design session –î–û –Ω–∞—á–∞–ª–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (15-30 –º–∏–Ω –Ω–∞ whiteboard)
- Checklist: "–ù—É–∂–µ–Ω –ª–∏ ADR –¥–ª—è —ç—Ç–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞?" (concurrency, external API, performance critical)

### 9. Integration vs Unit Testing –±–∞–ª–∞–Ω—Å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- 108 unit-—Ç–µ—Å—Ç–æ–≤, –Ω–æ –æ–Ω–∏ –Ω–µ –≤—ã—è–≤–ª—è—é—Ç integration –ø—Ä–æ–±–ª–µ–º—ã
- Mock'–∏ —É–ø—Ä–æ—â–∞—é—Ç —Ç–µ—Å—Ç—ã, –Ω–æ —Å–∫—Ä—ã–≤–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –±–∞–≥–∏

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:**
- –ü–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–æ–≤: 70% Unit / 20% Integration / 10% E2E
- Integration —Ç–µ—Å—Ç—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º TDLib (sandbox —Ä–µ–∂–∏–º)
- –£–±—Ä–∞—Ç—å MockTDLibClient –∏–∑ Component —Ç–µ—Å—Ç–æ–≤?

### 10. Swift 6 Concurrency: Best Practices

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –µ–¥–∏–Ω–æ–≥–æ —Å—Ç–∏–ª—è –¥–ª—è concurrency (actor, class + lock, Sendable)
- –ü—É—Ç–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É actor isolation –∏ thread safety

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:**
- Decision Tree –≤ ARCHITECTURE.md: "–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å actor vs lock"
- Code Review checklist –¥–ª—è concurrency –∫–æ–¥–∞
- –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ (TDLibClient, ResponseWaiters, ChatCollector)

### 11. –ü–æ–∑–¥–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ "—Ç–æ—á–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞" –æ—Ç C –∫ Swift Concurrency

**–ü—Ä–æ–±–ª–µ–º–∞:**
> –ú—ã –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—É —Å `[String: Any]` –∏ `@unchecked Sendable` —Ç–æ–ª—å–∫–æ –Ω–∞ 20-–π —Å–µ—Å—Å–∏–∏,
> —Ö–æ—Ç—è TDLibClient –±—ã–ª –Ω–∞–ø–∏—Å–∞–Ω –≤ –ø–µ—Ä–≤—ã—Ö —Å–µ—Å—Å–∏—è—Ö. –ü–æ—á–µ–º—É –º—ã –Ω–µ –≤—ã—è–≤–∏–ª–∏ —ç—Ç—É "—Ç–æ—á–∫—É –ø–µ—Ä–µ—Ö–æ–¥–∞"
> –æ—Ç –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∫ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º—É Swift Concurrency —Å—Ä–∞–∑—É?

**–í–æ–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:**
- –ü–æ—á–µ–º—É `receive()` –Ω–µ –±—ã–ª –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –ö–†–ò–¢–ò–ß–ù–ê–Ø —Ç–æ—á–∫–∞ boundary —Å C API?
- –ú–æ–≥–ª–∏ –ª–∏ –º—ã –≤—ã—è–≤–∏—Ç—å —ç—Ç–æ —á–µ—Ä–µ–∑ code review –∏–ª–∏ architectural review?
- –ù—É–∂–µ–Ω –ª–∏ checklist "–†–∞–±–æ—Ç–∞ —Å C interop" –¥–ª—è —Ç–∞–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤?
- –°—Ç–æ–∏—Ç –ª–∏ –¥–µ–ª–∞—Ç—å architectural review –î–û –Ω–∞—á–∞–ª–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ TDLibClient?

**Root cause –≥–∏–ø–æ—Ç–µ–∑—ã:**
1. –§–æ–∫—É—Å –Ω–∞ Outside-In TDD ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ internal implementation details
2. `@unchecked Sendable` –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ "–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ö–∞–∫" ‚Üí –Ω–µ –ø–æ–¥–Ω—è–ª–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
3. –ù–µ –±—ã–ª–æ —è–≤–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ "–≤–∞–ª–∏–¥–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ —Å C API"
4. Actor-first –ø–æ–¥—Ö–æ–¥ ‚Üí –ø—ã—Ç–∞–ª–∏—Å—å —Ä–µ—à–∏—Ç—å —á–µ—Ä–µ–∑ actor isolation –≤–º–µ—Å—Ç–æ validated wrapper

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ CLAUDE.md –ø—Ä–∞–≤–∏–ª–æ: "–ü—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å C API ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û validated wrapper"
- [ ] Checklist –¥–ª—è TDLibClient review: "Boundary validation —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞?"
- [ ] Architectural review –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã —Å external libraries

### 12. –£–∑–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ –ø—Ä–∏ —Ä–µ—à–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º: —É–ø–æ—Ä—Å—Ç–≤–æ –Ω–∞ –æ–¥–Ω–æ–º –ø–æ–¥—Ö–æ–¥–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**
> –ü—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ ResponseWaiters –≤ actor, Claude —É–ø–æ—Ä–Ω–æ –ø—Ä–µ–¥–ª–∞–≥–∞–ª `Task.yield()` (–¥–≤–∞–∂–¥—ã!)
> –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã (AsyncStream, callback, extension –¥–ª—è —Ç–µ—Å—Ç–æ–≤).
> –í –∏—Ç–æ–≥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏—à–ª–æ—Å—å —Å–∞–º–æ–º—É —Å–ø—Ä–æ—Å–∏—Ç—å –ø—Ä–æ –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.

**–í–æ–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:**
- –ü–æ—á–µ–º—É Claude –Ω–µ –ø—Ä–µ–¥–ª–æ–∂–∏–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ä–µ—à–µ–Ω–∏—è —Å—Ä–∞–∑—É?
- –ö–∞–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Ö–≤–∞—Ç–∞–ª–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —á—Ç–æ `Task.yield()` ‚Äî —Ö–∞–∫, –∞ –Ω–µ —Ä–µ—à–µ–Ω–∏–µ?
- –ö–∞–∫ —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å: —Å–Ω–∞—á–∞–ª–∞ –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã ‚Üí –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ ‚Üí –≤—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ?

**Root cause –≥–∏–ø–æ—Ç–µ–∑—ã:**
1. **–ü–µ—Ä–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ = –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ:** Claude —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ø–µ—Ä–≤–æ–º –Ω–∞–π–¥–µ–Ω–Ω–æ–º –ø–æ–¥—Ö–æ–¥–µ
2. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:** –Ω–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è —á—Ç–æ –≤ —Ç–µ—Å—Ç–∞—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å helpers
3. **–ù–µ—Ç –ø–∞—É–∑—ã –Ω–∞ –∞–Ω–∞–ª–∏–∑:** —Å—Ä–∞–∑—É –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –∫–æ–¥, –±–µ–∑ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤
4. **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ feedback:** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–≤–∞–∂–¥—ã –æ—Ç–∫–ª–æ–Ω—è–ª `Task.yield()`, –Ω–æ Claude –ø—Ä–æ–¥–æ–ª–∂–∞–ª

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:**
- [ ] –ü—Ä–∞–≤–∏–ª–æ: "–î–ª—è –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º ‚Äî –ø—Ä–µ–¥–ª–æ–∂–∏ 2-3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ä–µ—à–µ–Ω–∏—è"
- [ ] Checklist: "–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª —Ä–µ—à–µ–Ω–∏–µ ‚Üí —Å–ø—Ä–æ—Å–∏ –ß–¢–û –Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è"
- [ ] –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è concurrency: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å synchronization helpers (AsyncStream, callbacks)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ TESTING.md —Ä–∞–∑–¥–µ–ª "Testing Actor Code: Best Practices"

**–ò—Ç–æ–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–ø–æ—Å–ª–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è):**
```swift
// Extension —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
extension ResponseWaiters {
    nonisolated func addWaiterWithCallback(
        for type: String,
        continuation: CheckedContinuation<TDLibJSON, Error>,
        onRegistered: @escaping @Sendable () -> Void
    ) {
        Task {
            await self.addWaiter(for: type, continuation: continuation)
            onRegistered()  // ‚úÖ –°–∏–≥–Ω–∞–ª: –≥–æ—Ç–æ–≤–æ
        }
    }
}

// –í —Ç–µ—Å—Ç–µ: AsyncStream –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞
let (stream, cont) = AsyncStream.makeStream(of: Void.self)
waiters.addWaiterWithCallback(...) { cont.yield(()) }
_ = await stream.first(where: { _ in true })  // –ñ–¥—ë–º —Å–∏–≥–Ω–∞–ª–∞
```

### 13. –ü—Ä–∏–¥—É–º—ã–≤–∞–Ω–∏–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π: @extra –≤ MockTDLibFFI

**–ü—Ä–æ–±–ª–µ–º–∞:**
> –ü—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ MockTDLibClient ‚Üí MockTDLibFFI, Claude –¥–≤–∞–∂–¥—ã —É–≤–µ—Ä–µ–Ω–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏–ª –¥–æ–±–∞–≤–ª—è—Ç—å
> "@extra" –≤ JSON –æ—Ç–≤–µ—Ç—ã –¥–ª—è "—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å TDLib protocol", —Ö–æ—Ç—è:
> - TDLibClient **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç @extra** –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è request/response
> - ResponseWaiters —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ `requestType` (FIFO), –∏–≥–Ω–æ—Ä–∏—Ä—É—è @extra
> - –†–µ–∞–ª—å–Ω—ã–π –∫–æ–¥ **–ù–ï —á–∏—Ç–∞–µ—Ç –∏ –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç @extra**

**–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä (2025-11-21):**

```swift
// ‚ùå Claude –ø—Ä–µ–¥–ª–æ–∂–∏–ª (–¥–≤–∞–∂–¥—ã!):
json["@extra"] = fakeExtra  // "–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å TDLib protocol"

// ‚úÖ –†–µ–∞–ª—å–Ω–æ—Å—Ç—å (–ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞):
// TDLibClient –≤–æ–æ–±—â–µ –Ω–µ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ @extra!
// ResponseWaiters: addWaiter(for: expectedType, ...)  ‚Üê —Ç–æ–ª—å–∫–æ requestType!
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
1. Claude **–ù–ï –ü–†–û–ß–ò–¢–ê–õ –∫–æ–¥** ResponseWaiters/TDLibClient –ø–µ—Ä–µ–¥ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º
2. **–£–≤–µ—Ä–µ–Ω–Ω–æ –æ–±—ä—è—Å–Ω—è–ª –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–µ—Ö–∞–Ω–∏–∑–º:** "@extra —Ä–µ—à–∞–µ—Ç FIFO –ø—Ä–æ–±–ª–µ–º—É"
3. **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª –≤–æ–ø—Ä–æ—Å:** "–ê –≥–¥–µ –≤ –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è @extra?" ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∞–ª –Ω–∞—Å—Ç–∞–∏–≤–∞—Ç—å
4. **–ü—Ä–∏–¥—É–º–∞–ª —Ç–µ—Ä–º–∏–Ω:** "TDLib protocol compatibility" (—Ç–∞–∫–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –Ω–µ—Ç –≤ –ø—Ä–æ–µ–∫—Ç–µ)

**Root cause –≥–∏–ø–æ—Ç–µ–∑—ã:**
1. **–ü—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∏:** Claude —É–≥–∞–¥—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –≤–º–µ—Å—Ç–æ —á—Ç–µ–Ω–∏—è –∫–æ–¥–∞
2. **Cargo cult from other projects:** –≤–æ–∑–º–æ–∂–Ω–æ @extra –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –¥—Ä—É–≥–∏—Ö TDLib –æ–±—ë—Ä—Ç–∫–∞—Ö
3. **–ù–µ—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ claims:** –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á—Ç–æ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –∫–æ–¥–æ–º
4. **Overconfidence:** —É–≤–µ—Ä–µ–Ω–Ω—ã–π —Ç–æ–Ω –¥–∞–∂–µ –∫–æ–≥–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:**
- [ ] **–ü–†–ê–í–ò–õ–û:** –ü–µ—Ä–µ–¥ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
- [ ] **Checklist:** "–ï—Å—Ç—å –ª–∏ –≤ –∫–æ–¥–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ —ç—Ç–æ–≥–æ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è?" (grep/read –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º)
- [ ] **–Ø–≤–Ω–æ–µ —Å–æ–º–Ω–µ–Ω–∏–µ:** –ï—Å–ª–∏ –Ω–µ —á–∏—Ç–∞–ª –∫–æ–¥ ‚Äî —Å–∫–∞–∑–∞—Ç—å "–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞—é, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å"
- [ ] **–ü–∞—É–∑–∞ –Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å "–æ—Ç–∫—É–¥–∞ —ç—Ç–æ?" ‚Üí READ —Ñ–∞–π–ª—ã

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã–ª–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏:**
1. User: "–ó–∞—á–µ–º –Ω—É–∂–µ–Ω @extra?"
2. Claude: "–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –î–∞–≤–∞–π –ø—Ä–æ–≤–µ—Ä–∏–º –∫–∞–∫ ResponseWaiters —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç request/response"
3. Claude: `Read ResponseWaiters.swift` ‚Üí –≤–∏–¥–∏—Ç `addWaiter(for: expectedType, ...)`
4. Claude: `Grep @extra Sources/TDLibAdapter` ‚Üí –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
5. Claude: "–¢—ã –ø—Ä–∞–≤! @extra –ù–ï –Ω—É–∂–µ–Ω, ResponseWaiters —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ requestType FIFO"

**–°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏:**
- –ü–æ—Ö–æ–∂–µ –Ω–∞ –ø—É–Ω–∫—Ç 12 (Task.yield —É–ø–æ—Ä—Å—Ç–≤–æ) ‚Äî —Ñ–∏–∫—Å–∞—Ü–∏—è –Ω–∞ –ø–µ—Ä–≤–æ–º —Ä–µ—à–µ–Ω–∏–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ verification –ø–µ—Ä–µ–¥ —É–≤–µ—Ä–µ–Ω–Ω—ã–º–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è–º–∏

---

## üìã –ü–ª–∞–Ω —Ä–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤—ã

### –≠—Ç–∞–ø 1: –ê–Ω–∞–ª–∏–∑ (1 —á–∞—Å)
1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å –≤—Å–µ 13 –≤–æ–ø—Ä–æ—Å–æ–≤ –≤—ã—à–µ
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞: –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å root cause –ø—Ä–æ–±–ª–µ–º—ã
3. –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ impact (high/medium/low)

### –≠—Ç–∞–ø 2: –†–µ—à–µ–Ω–∏—è (1 —á–∞—Å)
1. –î–ª—è high-impact –ø—Ä–æ–±–ª–µ–º: –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
2. –û–±–Ω–æ–≤–∏—Ç—å DEVELOPMENT.md / TESTING.md / ARCHITECTURE.md
3. –°–æ–∑–¥–∞—Ç—å action items –≤ TASKS.md (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã code changes)

### –≠—Ç–∞–ø 3: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (30 –º–∏–Ω)
1. –ó–∞–ø–∏—Å–∞—Ç—å –≤—ã–≤–æ–¥—ã –≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª (—Å–µ–∫—Ü–∏—è "Conclusions")
2. –û–±–Ω–æ–≤–∏—Ç—å CLAUDE.md —Å –Ω–æ–≤—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
3. Prepend –∑–∞–ø–∏—Å—å –≤ CHANGELOG.md

---

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

1. ‚úÖ Decision Tree: "–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å actor vs NSLock vs OSAllocatedUnfairLock"
2. ‚úÖ Mat—Ä–∏—Ü–∞ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ –±–∞–≥–æ–≤ (data loss > deadlock > memory leak > performance)
3. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π Outside-In TDD workflow —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ E2E regression —Ç–µ—Å—Ç–∞–º–∏
4. ‚úÖ Lightweight ADR template –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
5. ‚úÖ Code Review checklist –¥–ª—è concurrency –∫–æ–¥–∞
6. ‚úÖ –ü–ª–∞–Ω –ø–æ —É–ª—É—á—à–µ–Ω–∏—é test coverage (concurrency stress tests)

---

## üìå –ö–æ–≥–¥–∞ –ø—Ä–æ–≤–æ–¥–∏—Ç—å

**–£—Å–ª–æ–≤–∏–µ:** –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è MVP-1.6 (ChannelMessageSource fetchUnreadMessages)

**–ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Ç–æ–≥–¥–∞:**
- –ë—É–¥–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª Outside-In TDD –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ
- –ù–∞–∫–æ–ø–∏—Ç—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—ã—Ç–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- –ú–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —É–ª—É—á—à–µ–Ω–∏—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö –º–æ–¥—É–ª—è—Ö (MVP-2, MVP-3)

---

## üìù Conclusions (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ä–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤—ã)

_TODO: –ó–∞–ø–∏—Å–∞—Ç—å –≤—ã–≤–æ–¥—ã –∏ action items –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ä–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤—ã_
