# –ó–∞–¥–∞—á–∏ –ø—Ä–æ–µ–∫—Ç–∞

> **–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:** v0.3.0 ‚úÖ
> **–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:** v0.4.0 (mark-as-read)

---

## üîÑ –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ v0.4.0 (—Ä–∞–∑ –≤ 1-3 –¥–Ω—è)

**–°—Ç–∞—Ç—É—Å:** ‚è≥ —Å–ª–µ–¥—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ _TBD_ (–Ω–∞—á–∞—Ç—å –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∫–æ–º–º–∏—Ç–∞ v0.4.0)

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç –∏–∑ [retro-v0.4.0-questions.md](archived/retro-v0.4.0-questions.md#-–ø—Ä–æ–º–ø—Ç-–¥–ª—è-—Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ-–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è-—Ä–∞–∑-–≤-1-3-–¥–Ω—è)
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–º–ø—Ç –≤ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
3. Append —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ [retro-v0.4.0-questions.md](archived/retro-v0.4.0-questions.md) (—Å–µ–∫—Ü–∏—è "–õ–æ–≥–∏ –º–µ—Ç—Ä–∏–∫")
4. –û–±–Ω–æ–≤–∏—Ç—å —ç—Ç—É –¥–∞—Ç—É –Ω–∞ +1-3 –¥–Ω—è

**–¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ v0.4.0:**
- Research-First: 100% (–±—ã–ª–æ 25% –≤ v0.3.0)
- Mock —Ç–æ–ª—å–∫–æ boundaries: 100% (–±—ã–ª–æ 0% –≤ v0.3.0)
- –î—É–±–ª–∏–∫–∞—Ç—ã —Ç–∏–ø–æ–≤: 0% (–±—ã–ª–æ 16% –≤ v0.3.0)
- Code Review: 100% –¥–Ω–µ–π —Å –∫–æ–º–º–∏—Ç–∞–º–∏ (–Ω–æ–≤–æ–µ)
- Concurrency: 0 —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–≤ –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫ (–Ω–æ–≤–æ–µ)

---

## üìã –¢–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏

### 1. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è v0.4.0: Mark as Read üî• –¢–ï–ö–£–©–ê–Ø –ó–ê–î–ê–ß–ê

**RFC:** [MVP.md ¬ß v0.4.0](MVP.md#v040-mark-as-read)

**–ö–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–≥–æ –≥—Ä—É–º–∏–Ω–≥–∞:**
- ‚úÖ Architecture-First –∞–Ω–∞–ª–∏–∑ (7 –±–ª–æ–∫–æ–≤)
- ‚úÖ Retry Strategy –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ BACKLOG
- ‚úÖ –í—Å–µ —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ RFC

**Task Breakdown (TDD: Outside-In):**

1. [ ] **DocC –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** ‚Äî User Story –¥–ª—è MarkAsReadService üéØ **–°–õ–ï–î–£–Æ–©–ê–Ø –°–ï–°–°–ò–Ø**
2. [ ] **Component Test (RED)** ‚Äî MarkAsReadService happy path
3. [ ] **Models + Unit Tests** ‚Äî ViewMessagesRequest: Codable
4. [ ] **MarkAsReadService implementation** ‚Üí Component Test GREEN
5. [ ] **Component Tests (edge cases)** ‚Äî empty, partial failure, timeout, cancellation
6. [ ] **TSan validation** ‚Äî `swift test --sanitize=thread --filter MarkAsReadServiceTests`
7. [ ] **DigestOrchestrator integration** ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ BotNotifier + MarkAsRead
8. [ ] **CLI —Ñ–ª–∞–≥** ‚Äî `--mark-as-read` / `--no-mark-as-read`
9. [ ] **E2E manual test** ‚Äî —Ä–µ–∞–ª—å–Ω—ã–π TDLib –Ω–∞ dev –æ–∫—Ä—É–∂–µ–Ω–∏–∏
10. [ ] **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å ARCHITECTURE.md (pipeline diagram)

**Acceptance Criteria:** –°–º. [MVP.md ¬ß Acceptance Criteria](MVP.md#acceptance-criteria)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í—Å–µ –∑–∞–¥–∞—á–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ [MVP.md ¬ß Task Breakdown](MVP.md#task-breakdown-tdd-outside-in) –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ.

---

### 2. TSan —É—á–µ–Ω–∏—è üîß –¢–ï–• –î–û–õ–ì

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –µ—Å–ª–∏ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤—Ä–µ–º—è)

**–¶–µ–ª—å:** –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –æ–ø—ã—Ç —Å Thread Sanitizer

**–ü–ª–∞–Ω:**
1. [ ] –ù–∞–ø–∏—Å–∞—Ç—å 3 –Ω–∞–º–µ—Ä–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∏ (race condition, deadlock, livelock)
2. [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `swift test --sanitize=thread`
3. [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ TSan –æ–±–Ω–∞—Ä—É–∂–∏–ª –≤—Å–µ 3 –æ—à–∏–±–∫–∏
4. [ ] –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –≤ `.claude/tsan-examples.md`

**–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞:** 3/3 –æ—à–∏–±–æ–∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã TSan

**–î–µ—Ç–∞–ª–∏:** [BACKLOG.md#thread-sanitizer-tsan-—É—á–µ–Ω–∏—è](BACKLOG.md#thread-sanitizer-tsan-—É—á–µ–Ω–∏—è)

---

### 3. Research: Retry Strategy üß™ –ò–°–°–õ–ï–î–û–í–ê–ù–ò–ï

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–µ—Å–ª–∏ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤—Ä–µ–º—è)

**–¶–µ–ª—å:** –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å best practices –¥–ª—è retry –ª–æ–≥–∏–∫–∏ –∏ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

**–ü–ª–∞–Ω:** –°–º. [BACKLOG.md#retry-strategy-best-practice](BACKLOG.md#retry-strategy-best-practice)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ADR –¥–æ–∫—É–º–µ–Ω—Ç –≤ `.claude/adr/001-retry-strategy.md`

---

### 4. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: ARCHITECTURE.md Pipeline Diagram üìù –¢–ï–• –î–û–õ–ì

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π (—á–∞—Å—Ç—å v0.4.0, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç)

**–¶–µ–ª—å:** –û–±–Ω–æ–≤–∏—Ç—å ARCHITECTURE.md —Å –¥–∏–∞–≥—Ä–∞–º–º–æ–π –Ω–æ–≤–æ–≥–æ pipeline (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)

**–ö–æ–≥–¥–∞:** –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ #1 (–∫–æ–≥–¥–∞ pipeline —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω).

---

### 5. Swift 6.2 Concurrency Flags üîß –¢–ï–• –î–û–õ–ì

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π (nice to have)

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã–µ concurrency —Ñ–ª–∞–≥–∏ Swift 6.2

**–§–ª–∞–≥–∏:**
- `NonisolatedNonsendingByDefault`
- `InferIsolatedConformances`

**–î–µ—Ç–∞–ª–∏:** [BACKLOG.md#thread-sanitizer-tsan-—É—á–µ–Ω–∏—è](BACKLOG.md#thread-sanitizer-tsan-—É—á–µ–Ω–∏—è)

---

### 6. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ SwiftPM Issue #9441 üéØ –ü–†–û–ì–†–ï–°–°

**–°—Ç–∞—Ç—É—Å:** ‚úÖ Root cause –Ω–∞–π–¥–µ–Ω, –ø—Ä–∏–ª–∏–Ω–∫–æ–≤–∞–Ω—ã 2 PR —Å —Ñ–∏–∫—Å–∞–º–∏

**PR (–æ–±–∞ OPEN):**
- PR #9490 (2025-12-10)
- PR #9493 (2025-12-11)

**–î–µ–π—Å—Ç–≤–∏—è:**
- [x] –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ PR
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é: `gh pr view 9490 --repo swiftlang/swift-package-manager`

---

**–°—Å—ã–ª–∫–∏:**
- [MVP.md](MVP.md) ‚Äî scope –∏ —Å—Ç–∞—Ç—É—Å MVP
- [BACKLOG.md](BACKLOG.md) ‚Äî –±—ç–∫–ª–æ–≥ –±—É–¥—É—â–∏—Ö —Ñ–∏—á
- [CHANGELOG.md](CHANGELOG.md) ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
