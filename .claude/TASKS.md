# –ó–∞–¥–∞—á–∏ –ø—Ä–æ–µ–∫—Ç–∞

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏

**–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏:**
1. –ü—Ä–æ—á–∏—Ç–∞–π —Ç–æ–ø-3 –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –Ω–∏–∂–µ
2. –ü—Ä–µ–¥–ª–æ–∂–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ MVP
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –Ω–µ—è—Å–Ω–∞) ‚Äî –ø–æ—Å–º–æ—Ç—Ä–∏ –¥–µ—Ç–∞–ª–∏ –≤ [MVP.md](.claude/MVP.md)
4. **TDD –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω**: –ø–∏—à–∏ —Ç–µ—Å—Ç—ã –î–û —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å–º. [TESTING.md](.claude/TESTING.md))

**–ü–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏:**
- –û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ
- **–ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä—É–π Swift-DocC –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** (–ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π/–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
- –ó–∞–ø–∏—à–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤ [CHANGELOG.md](.claude/CHANGELOG.md) (—Ç–æ–ª—å–∫–æ prepend —á–µ—Ä–µ–∑ bash)
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî –¥–æ–±–∞–≤—å –∏–¥–µ–∏ –≤ [BACKLOG.md](.claude/BACKLOG.md)

---

> üéØ **MVP (—Ü–µ–ª–∏ –∏ scope):** [MVP.md](.claude/MVP.md) ‚Äî —á–∏—Ç–∞—Ç—å –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é (–±–æ–ª—å—à–æ–π —Ñ–∞–π–ª)
> üí° **–ë—É–¥—É—â–∏–µ —Ñ–∏—á–∏:** [BACKLOG.md](.claude/BACKLOG.md) ‚Äî –±—ç–∫–ª–æ–≥ –¥–ª—è –≤–µ—Ä—Å–∏–π –ø–æ—Å–ª–µ MVP
> üìù **–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:** [CHANGELOG.md](.claude/CHANGELOG.md) ‚Äî –ª–æ–≥–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π, —á–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é (–±–æ–ª—å—à–æ–π —Ñ–∞–π–ª)
> üìã **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-27

---

## ‚ö†Ô∏è GIT SAFETY –ü–†–ê–í–ò–õ–ê

**–î–µ—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**
- **–ó–ê–ü–†–ï–©–ï–ù–û** `git reset --hard`, `git clean -fd` –ë–ï–ó —è–≤–Ω–æ–≥–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- –ü–µ—Ä–µ–¥ –¥–µ—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–µ–π: –ø–æ–∫–∞–∑–∞—Ç—å `git status`, –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç—å –ß–¢–û –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω–æ, —Å–ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- –î–ª—è –æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `git stash` –≤–º–µ—Å—Ç–æ `git reset --hard`

**–†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏:**
- **–ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π `cd`** –≤–æ –≤—Ä–µ–º—è git –æ–ø–µ—Ä–∞—Ü–∏–π (–∏—Å–ø–æ–ª—å–∑—É–π absolute paths)
- **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π `git mv`** –¥–ª—è tracked —Ñ–∞–π–ª–æ–≤ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç history)
- **–ö–æ–º–º–∏—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è** –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞—Ö (–ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —à–∞–≥–∞)

**–°–º. –¥–µ—Ç–∞–ª–∏:** [CLAUDE.md](.claude/CLAUDE.md) ‚Üí "–ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞" ‚Üí "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å git"

---

## üéØ –¢–æ–ø-3 –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ (—Ç–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏)

### üî• –ü–†–ò–û–†–ò–¢–ï–¢ 0: @extra matching –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (IN PROGRESS)

**–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–µ—Å—Å–∏–∏ 2025-11-28:**

| # | –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å |
|---|--------|--------|
| 1-5 | –ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å–µ—Å—Å–∏—è (ResponseWaiters, MockTDLibFFI copy) | ‚úÖ |
| 6 | send() ‚Üí String (TDLibFFI, CTDLibFFI, MockTDLibFFI, TDLibClient) | ‚úÖ |
| 7 | Updates loop: @extra parsing + forType –¥–ª—è auth | ‚úÖ |
| 8 | –£–¥–∞–ª–∏—Ç—å debug –ª–æ–≥–∏ –∏–∑ MockTDLibFFI | ‚úÖ |
| 9 | ResponseWaiters: –¥–æ–±–∞–≤–∏—Ç—å forType –¥–ª—è unsolicited updates | ‚úÖ |
| 10 | **TODO:** MockTDLibFFI mocking strategy (FIFO ‚Üí @extra matching) | ‚¨ú |

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ send() –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç @extra –≤–Ω—É—Ç—Ä–∏ FFI —Å–ª–æ—è (TDLibFFI, CTDLibFFI, MockTDLibFFI)
- ‚úÖ ResponseWaiters –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç forExtra (responses) –∏ forType (unsolicited updates –∫–∞–∫ auth)
- ‚úÖ startUpdatesLoop –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π @extra parsing
- ‚úÖ Debug –ø—Ä–∏–Ω—Ç—ã —É–±—Ä–∞–Ω—ã –∏–∑ MockTDLibFFI
- ‚ö†Ô∏è –¢–µ—Å—Ç 100 getChat: deadlock –∏—Å—á–µ–∑ (0.009s), –Ω–æ matching –Ω–µ–≤–µ—Ä–Ω—ã–π
  - **–ü—Ä–æ–±–ª–µ–º–∞:** MockTDLibFFI –º–æ–∫–∞–µ—Ç –ø–æ requestType (FIFO queue), –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç @extra
  - **–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –º–æ–∫–æ–≤ ‚Äî —Å–æ–∑–¥–∞–≤–∞—Ç—å responses –∑–∞—Ä–∞–Ω–µ–µ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ chatId, –º–∞—Ç—á–∏—Ç—å –ø–æ @extra

---

**–°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì: –ò—Å–ø—Ä–∞–≤–∏—Ç—å MockTDLibFFI mocking strategy**

**–ü—Ä–æ–±–ª–µ–º–∞:**
```swift
// –°–µ–π—á–∞—Å (FIFO –ø–æ —Ç–∏–ø—É):
mockFFI.mockResponse(forRequestType: "getChat", return: .success(chat1))  // queue[0]
mockFFI.mockResponse(forRequestType: "getChat", return: .success(chat2))  // queue[1]
// –ü—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –ø–æ—Ä—è–¥–æ–∫ –æ—Ç–≤–µ—Ç–æ–≤ = –ø–æ—Ä—è–¥–æ–∫ send(), –ù–ï –ø–æ—Ä—è–¥–æ–∫ –º–æ–∫–æ–≤
```

**–†–µ—à–µ–Ω–∏–µ:**
```swift
// –ù–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:
mockFFI.mockResponse(forExtra: "mock_1", return: .success(chat1))
mockFFI.mockResponse(forExtra: "mock_2", return: .success(chat2))
// –ú–∞—Ç—á–∏–Ω–≥ –ø–æ @extra, –∞ –Ω–µ FIFO
```

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `Tests/TestHelpers/MockTDLibFFI.swift` ‚Äî –∏–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É mockedResponses
- `Tests/TgClientUnitTests/TDLibAdapter/MockTDLibFFITests.swift` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã
- `Tests/TgClientUnitTests/TDLibAdapter/TDLibClientTests.swift` ‚Äî —Ç–µ—Å—Ç 100 getChat –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å GREEN

---

### üßπ BACKLOG: –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π getChats

**–ü—Ä–∏—á–∏–Ω–∞:** `getChats()` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∏–≥–¥–µ –≤ –∫–æ–¥–µ, –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ `loadChats()`.

**–ó–∞–¥–∞—á–∏:**
- [ ] –£–¥–∞–ª–∏—Ç—å `getChats()` –∏–∑ TDLibClientProtocol
- [ ] –£–¥–∞–ª–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏–∑ TDLibClient+HighLevelAPI
- [ ] –£–¥–∞–ª–∏—Ç—å `GetChatsRequest` –º–æ–¥–µ–ª—å
- [ ] –£–¥–∞–ª–∏—Ç—å `ChatsResponse` –º–æ–¥–µ–ª—å (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

### üî• –ü–†–ò–û–†–ò–¢–ï–¢ 1: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å AuthenticationFlowTests

**–°—Ç–∞—Ç—É—Å:** –í—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ `Tests/TgClientComponentTests/TDLibAdapter/AuthenticationFlowTests.swift`

**–ó–∞–¥–∞—á–∞:**
1. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –Ω–∞ TDLibClient + MockTDLibFFI (–≤–º–µ—Å—Ç–æ —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ MockTDLibClient)
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω –∏–∑ ChannelMessageSourceTests –∫–∞–∫ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å coverage:
   - Phone + Code ‚Üí Ready
   - Phone + Code + 2FA Password ‚Üí Ready
   - Error handling (–Ω–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥, –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å)

**–†–µ—Ñ–µ—Ä–µ–Ω—Å:** `Tests/TgClientComponentTests/DigestCore/ChannelMessageSourceTests.swift`

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ü–†–ò–û–†–ò–¢–ï–¢ 0 (@extra matching –Ω—É–∂–µ–Ω –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ç–µ—Å—Ç–æ–≤)

---

### üî• –ü–†–ò–û–†–ò–¢–ï–¢ 2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è MVP-1.6 (ChannelMessageSource)

**–°—Ç–∞—Ç—É—Å:** Component —Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã (RED —Ñ–∞–∑–∞), –∂–¥—É—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–ó–∞–¥–∞—á–∏:**
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `ChannelMessageSource.fetchUnreadMessages()`
- [ ] –ê–ª–≥–æ—Ä–∏—Ç–º: loadChats loop ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ updates ‚Üí —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–∞–Ω–∞–ª–æ–≤ ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] Stateless –ø–æ–¥—Ö–æ–¥ (–±–µ–∑ realtime –∫–µ—à–∞ –¥–ª—è MVP)

**–§–∞–π–ª—ã:**
- `Sources/DigestCore/Sources/ChannelMessageSource.swift`
- `Tests/TgClientComponentTests/DigestCore/ChannelMessageSourceTests.swift`

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ü–†–ò–û–†–ò–¢–ï–¢ 0 –∏ –ü–†–ò–û–†–ò–¢–ï–¢ 1

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:**
- [ARCHITECTURE.md](.claude/ARCHITECTURE.md) - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- [DEVELOPMENT.md](.claude/DEVELOPMENT.md) - –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- [TESTING.md](.claude/TESTING.md) - —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [PROMPTS.md](.claude/PROMPTS.md) - —Ä–æ–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–¥–∞—á

**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é):**
- [SETUP.md](.claude/SETUP.md) - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [DEPLOY.md](.claude/DEPLOY.md) - –¥–µ–ø–ª–æ–π –Ω–∞ Linux VPS
- [CREDENTIALS.md](.claude/CREDENTIALS.md) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏
- [TROUBLESHOOTING.md](.claude/TROUBLESHOOTING.md) - —á–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-27
**–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:** –°–º. [CHANGELOG.md](.claude/CHANGELOG.md)
